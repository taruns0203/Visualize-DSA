<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Animated Iterative Two-Pointer Merge Visualization</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Poppins:wght@400;600;700&family=Permanent+Marker&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Poppins", sans-serif;
        background: linear-gradient(
          135deg,
          #1a1a2e 0%,
          #16213e 50%,
          #0f3460 100%
        );
        min-height: 100vh;
        padding: 20px;
        overflow-x: hidden;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      /* Header */
      .header {
        text-align: center;
        margin-bottom: 30px;
      }

      .title {
        font-family: "Permanent Marker", cursive;
        font-size: 2.5rem;
        background: linear-gradient(90deg, #00ff88, #00d9ff, #ff6b9d);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 10px;
        animation: titleShift 5s ease-in-out infinite;
      }

      @keyframes titleShift {
        0%,
        100% {
          filter: hue-rotate(0deg);
        }
        50% {
          filter: hue-rotate(30deg);
        }
      }

      .subtitle {
        color: #a0aec0;
        font-size: 1.1rem;
      }

      /* Key Insight Box */
      .insight-box {
        background: linear-gradient(
          135deg,
          rgba(0, 255, 136, 0.1),
          rgba(0, 217, 255, 0.1)
        );
        border: 2px solid #00ff88;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 25px;
        text-align: center;
      }

      .insight-title {
        font-family: "Permanent Marker", cursive;
        font-size: 1.2rem;
        color: #00ff88;
        margin-bottom: 10px;
      }

      .insight-text {
        color: #e0e0e0;
        font-size: 1rem;
        line-height: 1.6;
      }

      .insight-highlight {
        color: #00d9ff;
        font-weight: 600;
      }

      /* Step Display */
      .step-display {
        background: rgba(0, 0, 0, 0.4);
        border-radius: 15px;
        padding: 20px 30px;
        margin-bottom: 25px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        text-align: center;
      }

      .step-phase {
        font-size: 0.9rem;
        color: #a0aec0;
        margin-bottom: 8px;
      }

      .step-description {
        font-family: "Fira Code", monospace;
        font-size: 1.1rem;
        color: #fff;
        margin-bottom: 15px;
      }

      .step-description .highlight {
        color: #00ff88;
        font-weight: 600;
      }
      .step-description .l1 {
        color: #00d9ff;
      }
      .step-description .l2 {
        color: #ff6b9d;
      }
      .step-description .merged {
        color: #ffd93d;
      }

      .progress-container {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        height: 8px;
        overflow: hidden;
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #00d9ff, #00ff88);
        border-radius: 10px;
        transition: width 0.3s ease;
      }

      /* Main Visualization */
      .viz-main {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 25px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      /* Lists Container */
      .lists-container {
        display: flex;
        flex-direction: column;
        gap: 40px;
        margin-bottom: 40px;
      }

      .list-row {
        display: flex;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
      }

      .list-label {
        font-family: "Fira Code", monospace;
        font-size: 1rem;
        font-weight: 600;
        min-width: 80px;
      }

      .list-label.l1 {
        color: #00d9ff;
      }
      .list-label.l2 {
        color: #ff6b9d;
      }
      .list-label.dummy {
        color: #a855f7;
      }
      .list-label.merged {
        color: #ffd93d;
      }

      .nodes-container {
        display: flex;
        align-items: center;
        gap: 8px;
        position: relative;
      }

      /* Node Styling */
      .node-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
      }

      .pointer-label {
        font-family: "Fira Code", monospace;
        font-size: 0.75rem;
        padding: 3px 10px;
        border-radius: 10px;
        margin-bottom: 8px;
        opacity: 0;
        transform: translateY(-10px);
        transition: all 0.3s ease;
      }

      .pointer-label.visible {
        opacity: 1;
        transform: translateY(0);
      }

      .pointer-label.p1 {
        background: #00d9ff;
        color: #1a1a2e;
      }

      .pointer-label.p2 {
        background: #ff6b9d;
        color: #1a1a2e;
      }

      .pointer-label.tail {
        background: #ffd93d;
        color: #1a1a2e;
      }

      .pointer-arrow {
        width: 0;
        height: 0;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        margin-bottom: 5px;
        opacity: 0;
        transition: all 0.3s ease;
      }

      .pointer-arrow.visible {
        opacity: 1;
      }

      .pointer-arrow.p1 {
        border-top: 12px solid #00d9ff;
      }
      .pointer-arrow.p2 {
        border-top: 12px solid #ff6b9d;
      }
      .pointer-arrow.tail {
        border-top: 12px solid #ffd93d;
      }

      .node {
        width: 55px;
        height: 55px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Fira Code", monospace;
        font-size: 1.4rem;
        font-weight: 600;
        color: white;
        position: relative;
        transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      }

      .node.l1 {
        background: linear-gradient(135deg, #00d9ff, #0099cc);
      }
      .node.l2 {
        background: linear-gradient(135deg, #ff6b9d, #cc3366);
      }
      .node.dummy {
        background: linear-gradient(135deg, #a855f7, #7c3aed);
      }
      .node.merged {
        background: linear-gradient(135deg, #ffd93d, #f59e0b);
      }

      .node.active {
        transform: scale(1.15);
        box-shadow: 0 0 30px rgba(0, 255, 136, 0.6);
      }

      .node.used {
        opacity: 0.35;
        transform: scale(0.9);
      }

      .node.comparing {
        animation: comparePulse 0.8s ease-in-out infinite;
      }

      @keyframes comparePulse {
        0%,
        100% {
          box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }
        50% {
          box-shadow: 0 0 40px rgba(255, 255, 255, 0.8);
        }
      }

      .node.moving {
        animation: nodeMove 0.5s ease-out;
      }

      @keyframes nodeMove {
        0% {
          transform: scale(1.2);
        }
        50% {
          transform: scale(1.3) rotate(5deg);
        }
        100% {
          transform: scale(1);
        }
      }

      .arrow {
        font-size: 1.5rem;
        color: rgba(255, 255, 255, 0.3);
        transition: all 0.3s ease;
      }

      .arrow.active {
        color: #00ff88;
        text-shadow: 0 0 10px rgba(0, 255, 136, 0.8);
      }

      .arrow.linking {
        animation: linkPulse 0.5s ease-out;
      }

      @keyframes linkPulse {
        0% {
          transform: scale(1);
          color: #ffd93d;
        }
        50% {
          transform: scale(1.5);
          color: #00ff88;
        }
        100% {
          transform: scale(1);
          color: #00ff88;
        }
      }

      .null-text {
        font-family: "Fira Code", monospace;
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.4);
        font-style: italic;
      }

      /* Comparison Box */
      .comparison-box {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
        min-height: 80px;
        border: 2px solid transparent;
        transition: all 0.3s ease;
      }

      .comparison-box.active {
        border-color: rgba(255, 255, 255, 0.3);
        background: rgba(255, 255, 255, 0.1);
      }

      .compare-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
      }

      .compare-value {
        font-family: "Fira Code", monospace;
        font-size: 2rem;
        font-weight: 700;
        transition: all 0.3s ease;
      }

      .compare-value.l1 {
        color: #00d9ff;
      }
      .compare-value.l2 {
        color: #ff6b9d;
      }

      .compare-value.winner {
        transform: scale(1.2);
        text-shadow: 0 0 20px currentColor;
      }

      .compare-source {
        font-size: 0.8rem;
        color: #a0aec0;
      }

      .compare-operator {
        font-family: "Permanent Marker", cursive;
        font-size: 1.5rem;
        color: #ffd93d;
      }

      .compare-result {
        font-family: "Fira Code", monospace;
        font-size: 1.2rem;
        padding: 8px 20px;
        border-radius: 20px;
        opacity: 0;
        transform: scale(0);
        transition: all 0.3s ease;
      }

      .compare-result.visible {
        opacity: 1;
        transform: scale(1);
      }

      .compare-result.yes {
        background: rgba(0, 255, 136, 0.2);
        color: #00ff88;
        border: 2px solid #00ff88;
      }

      .compare-result.no {
        background: rgba(255, 107, 157, 0.2);
        color: #ff6b9d;
        border: 2px solid #ff6b9d;
      }

      /* Merged List Section */
      .merged-section {
        background: linear-gradient(
          135deg,
          rgba(255, 217, 61, 0.1),
          rgba(245, 158, 11, 0.05)
        );
        border: 2px solid #ffd93d;
        border-radius: 15px;
        padding: 20px;
      }

      .merged-title {
        font-family: "Permanent Marker", cursive;
        font-size: 1.2rem;
        color: #ffd93d;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .merged-nodes {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
        min-height: 70px;
      }

      .merged-node {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Fira Code", monospace;
        font-size: 1.3rem;
        font-weight: 600;
        color: white;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        opacity: 0;
        transform: scale(0) translateY(20px);
        transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }

      .merged-node.visible {
        opacity: 1;
        transform: scale(1) translateY(0);
      }

      .merged-node.from-l1 {
        background: linear-gradient(135deg, #00d9ff, #0099cc);
      }
      .merged-node.from-l2 {
        background: linear-gradient(135deg, #ff6b9d, #cc3366);
      }
      .merged-node.dummy-node {
        background: linear-gradient(135deg, #a855f7, #7c3aed);
      }

      .merged-node.new {
        animation: newNodePop 0.5s ease-out;
      }

      @keyframes newNodePop {
        0% {
          transform: scale(0) rotate(-180deg);
        }
        70% {
          transform: scale(1.2) rotate(10deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
        }
      }

      .merged-arrow {
        font-size: 1.3rem;
        color: #ffd93d;
        opacity: 0;
        transition: all 0.3s ease;
      }

      .merged-arrow.visible {
        opacity: 1;
      }

      /* Controls */
      .controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 25px;
        flex-wrap: wrap;
      }

      .control-btn {
        font-family: "Poppins", sans-serif;
        font-size: 1rem;
        font-weight: 600;
        padding: 12px 25px;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .control-btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }

      .control-btn.prev {
        background: linear-gradient(135deg, #4a4a6a, #3a3a5a);
        color: white;
      }

      .control-btn.next {
        background: linear-gradient(135deg, #00d9ff, #0099cc);
        color: white;
      }

      .control-btn.play {
        background: linear-gradient(135deg, #00ff88, #00cc6a);
        color: #1a1a2e;
      }

      .control-btn.reset {
        background: linear-gradient(135deg, #ff6b9d, #cc3366);
        color: white;
      }

      .control-btn:not(:disabled):hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .speed-control {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #a0aec0;
      }

      .speed-slider {
        width: 100px;
        height: 6px;
        border-radius: 3px;
        background: rgba(255, 255, 255, 0.2);
        outline: none;
        -webkit-appearance: none;
      }

      .speed-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #00d9ff;
        cursor: pointer;
      }

      /* Final Result */
      .final-result {
        background: linear-gradient(
          135deg,
          rgba(0, 255, 136, 0.15),
          rgba(0, 217, 255, 0.1)
        );
        border: 3px solid #00ff88;
        border-radius: 20px;
        padding: 30px;
        text-align: center;
        opacity: 0;
        transform: scale(0.9);
        transition: all 0.5s ease;
        margin-top: 25px;
      }

      .final-result.visible {
        opacity: 1;
        transform: scale(1);
      }

      .final-title {
        font-family: "Permanent Marker", cursive;
        font-size: 1.8rem;
        color: #00ff88;
        margin-bottom: 20px;
      }

      .final-nodes {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 25px;
      }

      .final-node {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Fira Code", monospace;
        font-size: 1.5rem;
        font-weight: 700;
        color: white;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        opacity: 0;
        transform: scale(0);
        transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }

      .final-node.visible {
        opacity: 1;
        transform: scale(1);
      }

      .final-node.l1 {
        background: linear-gradient(135deg, #00d9ff, #0099cc);
      }
      .final-node.l2 {
        background: linear-gradient(135deg, #ff6b9d, #cc3366);
      }

      .final-arrow {
        font-size: 1.5rem;
        color: #00ff88;
        opacity: 0;
        transition: all 0.3s ease;
      }

      .final-arrow.visible {
        opacity: 1;
      }

      /* Complexity Cards */
      .complexity-cards {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
        margin-bottom: 20px;
      }

      .complexity-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 15px 30px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .complexity-label {
        font-size: 0.85rem;
        color: #a0aec0;
        margin-bottom: 5px;
      }

      .complexity-value {
        font-family: "Fira Code", monospace;
        font-size: 1.4rem;
        font-weight: 600;
      }

      .complexity-card.time .complexity-value {
        color: #00d9ff;
      }
      .complexity-card.space .complexity-value {
        color: #00ff88;
      }

      /* Code Section */
      .code-section {
        background: #1e1e1e;
        border-radius: 15px;
        padding: 20px;
        margin-top: 20px;
        overflow-x: auto;
      }

      .code-title {
        font-family: "Fira Code", monospace;
        font-size: 0.9rem;
        color: #00d9ff;
        margin-bottom: 15px;
      }

      .code-block {
        font-family: "Fira Code", monospace;
        font-size: 0.85rem;
        line-height: 1.8;
        color: #d4d4d4;
      }

      .code-block .keyword {
        color: #c586c0;
      }
      .code-block .function {
        color: #dcdcaa;
      }
      .code-block .param {
        color: #9cdcfe;
      }
      .code-block .comment {
        color: #6a9955;
      }
      .code-block .null {
        color: #569cd6;
      }

      .code-line {
        display: block;
        padding: 2px 10px;
        margin: 0 -10px;
        border-radius: 4px;
        transition: background 0.3s ease;
      }

      .code-line.highlight {
        background: rgba(0, 255, 136, 0.15);
      }

      /* Responsive */
      @media (max-width: 768px) {
        .title {
          font-size: 1.8rem;
        }
        .node {
          width: 45px;
          height: 45px;
          font-size: 1.2rem;
        }
        .merged-node {
          width: 40px;
          height: 40px;
          font-size: 1.1rem;
        }
        .compare-value {
          font-size: 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1 class="title">üëÜüëÜ Iterative Two-Pointer Merge</h1>
        <p class="subtitle">
          Watch pointers dance through both lists, building the result in one
          pass!
        </p>
      </div>

      <!-- Key Insight -->
      <div class="insight-box">
        <div class="insight-title">üí° KEY INSIGHT</div>
        <p class="insight-text">
          Both lists are <span class="insight-highlight">already sorted</span>!
          Use two pointers to compare heads, always pick the
          <span class="insight-highlight">smaller value</span>, link it to
          result, and advance that pointer.
          <strong>One pass, O(1) extra space!</strong>
        </p>
      </div>

      <!-- Step Display -->
      <div class="step-display">
        <div class="step-phase" id="stepPhase">Ready to start</div>
        <div class="step-description" id="stepDescription">
          Click <span class="highlight">Next</span> or
          <span class="highlight">Play</span> to begin the animation
        </div>
        <div class="progress-container">
          <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button class="control-btn prev" id="prevBtn" onclick="prevStep()">
          <span>‚Üê</span> Previous
        </button>
        <button class="control-btn next" id="nextBtn" onclick="nextStep()">
          Next <span>‚Üí</span>
        </button>
        <button class="control-btn play" id="playBtn" onclick="togglePlay()">
          <span id="playIcon">‚ñ∂</span> <span id="playText">Play</span>
        </button>
        <button class="control-btn reset" onclick="resetAnimation()">
          <span>‚Ü∫</span> Reset
        </button>
        <div class="speed-control">
          <span>Speed:</span>
          <input
            type="range"
            class="speed-slider"
            id="speedSlider"
            min="500"
            max="2500"
            value="1200"
            onchange="updateSpeed()"
          />
        </div>
      </div>

      <!-- Main Visualization -->
      <div class="viz-main">
        <!-- Source Lists -->
        <div class="lists-container">
          <!-- List 1 -->
          <div class="list-row">
            <span class="list-label l1">list1:</span>
            <div class="nodes-container" id="list1Container">
              <!-- Nodes will be generated by JS -->
            </div>
          </div>

          <!-- List 2 -->
          <div class="list-row">
            <span class="list-label l2">list2:</span>
            <div class="nodes-container" id="list2Container">
              <!-- Nodes will be generated by JS -->
            </div>
          </div>
        </div>

        <!-- Comparison Box -->
        <div class="comparison-box" id="comparisonBox">
          <div class="compare-item" id="compareL1">
            <div class="compare-value l1" id="compareValueL1">?</div>
            <div class="compare-source">list1</div>
          </div>
          <div class="compare-operator" id="compareOp">‚â§</div>
          <div class="compare-item" id="compareL2">
            <div class="compare-value l2" id="compareValueL2">?</div>
            <div class="compare-source">list2</div>
          </div>
          <div class="compare-result" id="compareResult">YES</div>
        </div>

        <!-- Merged List -->
        <div class="merged-section">
          <div class="merged-title">
            <span>üî®</span>
            <span>Building Merged List:</span>
          </div>
          <div class="merged-nodes" id="mergedNodes">
            <!-- Merged nodes will be added here -->
          </div>
        </div>
      </div>

      <!-- Final Result -->
      <div class="final-result" id="finalResult">
        <div class="final-title">
          ‚úÖ Merge Complete ‚Äî O(n+m) Time, O(1) Space!
        </div>
        <div class="final-nodes" id="finalNodes">
          <div class="final-node l1" data-index="0">1</div>
          <span class="final-arrow" data-index="0">‚Üí</span>
          <div class="final-node l2" data-index="1">1</div>
          <span class="final-arrow" data-index="1">‚Üí</span>
          <div class="final-node l1" data-index="2">2</div>
          <span class="final-arrow" data-index="2">‚Üí</span>
          <div class="final-node l2" data-index="3">3</div>
          <span class="final-arrow" data-index="3">‚Üí</span>
          <div class="final-node l1" data-index="4">4</div>
          <span class="final-arrow" data-index="4">‚Üí</span>
          <div class="final-node l2" data-index="5">4</div>
        </div>

        <div class="complexity-cards">
          <div class="complexity-card time">
            <div class="complexity-label">Time Complexity</div>
            <div class="complexity-value">O(n + m)</div>
          </div>
          <div class="complexity-card space">
            <div class="complexity-label">Space Complexity</div>
            <div class="complexity-value">O(1)</div>
          </div>
        </div>

        <!-- Code Section -->
        <div class="code-section">
          <div class="code-title">// Iterative Two-Pointer Implementation</div>
          <pre
            class="code-block"
          ><span class="code-line" id="codeLine1"><span class="keyword">function</span> <span class="function">mergeTwoLists</span>(<span class="param">list1</span>, <span class="param">list2</span>) {</span>
<span class="code-line" id="codeLine2">    <span class="keyword">const</span> <span class="param">dummy</span> = <span class="keyword">new</span> <span class="function">ListNode</span>(-1);</span>
<span class="code-line" id="codeLine3">    <span class="keyword">let</span> <span class="param">tail</span> = <span class="param">dummy</span>;</span>
<span class="code-line" id="codeLine4"></span>
<span class="code-line" id="codeLine5">    <span class="keyword">while</span> (<span class="param">list1</span> !== <span class="null">null</span> && <span class="param">list2</span> !== <span class="null">null</span>) {</span>
<span class="code-line" id="codeLine6">        <span class="keyword">if</span> (<span class="param">list1</span>.val <= <span class="param">list2</span>.val) {</span>
<span class="code-line" id="codeLine7">            <span class="param">tail</span>.next = <span class="param">list1</span>;</span>
<span class="code-line" id="codeLine8">            <span class="param">list1</span> = <span class="param">list1</span>.next;</span>
<span class="code-line" id="codeLine9">        } <span class="keyword">else</span> {</span>
<span class="code-line" id="codeLine10">            <span class="param">tail</span>.next = <span class="param">list2</span>;</span>
<span class="code-line" id="codeLine11">            <span class="param">list2</span> = <span class="param">list2</span>.next;</span>
<span class="code-line" id="codeLine12">        }</span>
<span class="code-line" id="codeLine13">        <span class="param">tail</span> = <span class="param">tail</span>.next;</span>
<span class="code-line" id="codeLine14">    }</span>
<span class="code-line" id="codeLine15"></span>
<span class="code-line" id="codeLine16">    <span class="param">tail</span>.next = <span class="param">list1</span> ?? <span class="param">list2</span>; <span class="comment">// Attach remainder</span></span>
<span class="code-line" id="codeLine17">    <span class="keyword">return</span> <span class="param">dummy</span>.next;</span>
<span class="code-line" id="codeLine18">}</span></pre>
        </div>
      </div>
    </div>

    <script>
      // Data
      const list1 = [1, 2, 4];
      const list2 = [1, 3, 4];

      // Animation state
      let currentStep = -1;
      let isPlaying = false;
      let playInterval = null;
      let animationSpeed = 1200;

      // Steps definition
      const steps = [
        {
          phase: "INITIALIZATION",
          description:
            'Create <span class="merged">dummy node</span> (-1) and set <span class="merged">tail</span> pointer to it',
          p1: 0,
          p2: 0,
          tail: -1,
          merged: [{ val: -1, from: "dummy" }],
          compare: null,
          codeLines: [2, 3],
        },
        {
          phase: "COMPARE & LINK",
          description:
            'Compare <span class="l1">1</span> ‚â§ <span class="l2">1</span>? <span class="highlight">YES!</span> Link list1\'s node',
          p1: 0,
          p2: 0,
          tail: 0,
          compare: { v1: 1, v2: 1, result: "yes", winner: "l1" },
          action: "link-l1",
          merged: [
            { val: -1, from: "dummy" },
            { val: 1, from: "l1" },
          ],
          codeLines: [5, 6, 7, 8, 13],
        },
        {
          phase: "ADVANCE POINTER",
          description:
            'Advance <span class="l1">p1</span> to next node, move <span class="merged">tail</span> forward',
          p1: 1,
          p2: 0,
          tail: 1,
          compare: null,
          merged: [
            { val: -1, from: "dummy" },
            { val: 1, from: "l1" },
          ],
          codeLines: [8, 13],
        },
        {
          phase: "COMPARE & LINK",
          description:
            'Compare <span class="l1">2</span> ‚â§ <span class="l2">1</span>? <span class="highlight">NO!</span> Link list2\'s node',
          p1: 1,
          p2: 0,
          tail: 1,
          compare: { v1: 2, v2: 1, result: "no", winner: "l2" },
          action: "link-l2",
          merged: [
            { val: -1, from: "dummy" },
            { val: 1, from: "l1" },
            { val: 1, from: "l2" },
          ],
          codeLines: [5, 6, 9, 10, 11, 13],
        },
        {
          phase: "ADVANCE POINTER",
          description:
            'Advance <span class="l2">p2</span> to next node, move <span class="merged">tail</span> forward',
          p1: 1,
          p2: 1,
          tail: 2,
          compare: null,
          merged: [
            { val: -1, from: "dummy" },
            { val: 1, from: "l1" },
            { val: 1, from: "l2" },
          ],
          codeLines: [11, 13],
        },
        {
          phase: "COMPARE & LINK",
          description:
            'Compare <span class="l1">2</span> ‚â§ <span class="l2">3</span>? <span class="highlight">YES!</span> Link list1\'s node',
          p1: 1,
          p2: 1,
          tail: 2,
          compare: { v1: 2, v2: 3, result: "yes", winner: "l1" },
          action: "link-l1",
          merged: [
            { val: -1, from: "dummy" },
            { val: 1, from: "l1" },
            { val: 1, from: "l2" },
            { val: 2, from: "l1" },
          ],
          codeLines: [5, 6, 7, 8, 13],
        },
        {
          phase: "ADVANCE POINTER",
          description:
            'Advance <span class="l1">p1</span> to next node, move <span class="merged">tail</span> forward',
          p1: 2,
          p2: 1,
          tail: 3,
          compare: null,
          merged: [
            { val: -1, from: "dummy" },
            { val: 1, from: "l1" },
            { val: 1, from: "l2" },
            { val: 2, from: "l1" },
          ],
          codeLines: [8, 13],
        },
        {
          phase: "COMPARE & LINK",
          description:
            'Compare <span class="l1">4</span> ‚â§ <span class="l2">3</span>? <span class="highlight">NO!</span> Link list2\'s node',
          p1: 2,
          p2: 1,
          tail: 3,
          compare: { v1: 4, v2: 3, result: "no", winner: "l2" },
          action: "link-l2",
          merged: [
            { val: -1, from: "dummy" },
            { val: 1, from: "l1" },
            { val: 1, from: "l2" },
            { val: 2, from: "l1" },
            { val: 3, from: "l2" },
          ],
          codeLines: [5, 6, 9, 10, 11, 13],
        },
        {
          phase: "ADVANCE POINTER",
          description:
            'Advance <span class="l2">p2</span> to next node, move <span class="merged">tail</span> forward',
          p1: 2,
          p2: 2,
          tail: 4,
          compare: null,
          merged: [
            { val: -1, from: "dummy" },
            { val: 1, from: "l1" },
            { val: 1, from: "l2" },
            { val: 2, from: "l1" },
            { val: 3, from: "l2" },
          ],
          codeLines: [11, 13],
        },
        {
          phase: "COMPARE & LINK",
          description:
            'Compare <span class="l1">4</span> ‚â§ <span class="l2">4</span>? <span class="highlight">YES!</span> Link list1\'s node',
          p1: 2,
          p2: 2,
          tail: 4,
          compare: { v1: 4, v2: 4, result: "yes", winner: "l1" },
          action: "link-l1",
          merged: [
            { val: -1, from: "dummy" },
            { val: 1, from: "l1" },
            { val: 1, from: "l2" },
            { val: 2, from: "l1" },
            { val: 3, from: "l2" },
            { val: 4, from: "l1" },
          ],
          codeLines: [5, 6, 7, 8, 13],
        },
        {
          phase: "LIST1 EXHAUSTED",
          description:
            '<span class="l1">list1</span> is now <span class="highlight">null</span>! Exit while loop.',
          p1: 3,
          p2: 2,
          tail: 5,
          compare: null,
          merged: [
            { val: -1, from: "dummy" },
            { val: 1, from: "l1" },
            { val: 1, from: "l2" },
            { val: 2, from: "l1" },
            { val: 3, from: "l2" },
            { val: 4, from: "l1" },
          ],
          codeLines: [5, 14],
        },
        {
          phase: "ATTACH REMAINDER",
          description:
            'Attach remaining <span class="l2">list2</span> nodes: <span class="l2">[4]</span>',
          p1: 3,
          p2: 2,
          tail: 5,
          compare: null,
          action: "attach-remainder",
          merged: [
            { val: -1, from: "dummy" },
            { val: 1, from: "l1" },
            { val: 1, from: "l2" },
            { val: 2, from: "l1" },
            { val: 3, from: "l2" },
            { val: 4, from: "l1" },
            { val: 4, from: "l2" },
          ],
          codeLines: [16],
        },
        {
          phase: "‚úÖ COMPLETE",
          description:
            'Return <span class="merged">dummy.next</span> ‚Üí <span class="highlight">[1‚Üí1‚Üí2‚Üí3‚Üí4‚Üí4]</span>',
          p1: 3,
          p2: 3,
          tail: 6,
          compare: null,
          merged: [
            { val: -1, from: "dummy" },
            { val: 1, from: "l1" },
            { val: 1, from: "l2" },
            { val: 2, from: "l1" },
            { val: 3, from: "l2" },
            { val: 4, from: "l1" },
            { val: 4, from: "l2" },
          ],
          codeLines: [17],
        },
      ];

      // Initialize
      function init() {
        renderLists();
        updateDisplay();
      }

      // Render source lists
      function renderLists() {
        const list1Container = document.getElementById("list1Container");
        const list2Container = document.getElementById("list2Container");

        list1Container.innerHTML = "";
        list2Container.innerHTML = "";

        // Render list1
        list1.forEach((val, idx) => {
          const wrapper = document.createElement("div");
          wrapper.className = "node-wrapper";
          wrapper.id = `l1-wrapper-${idx}`;
          wrapper.innerHTML = `
                    <span class="pointer-label p1" id="l1-p1-${idx}">p1</span>
                    <div class="pointer-arrow p1" id="l1-arrow-${idx}"></div>
                    <div class="node l1" id="l1-node-${idx}">${val}</div>
                `;
          list1Container.appendChild(wrapper);

          if (idx < list1.length - 1) {
            const arrow = document.createElement("span");
            arrow.className = "arrow";
            arrow.id = `l1-link-${idx}`;
            arrow.textContent = "‚Üí";
            list1Container.appendChild(arrow);
          }
        });

        // Add null at end
        const nullL1 = document.createElement("span");
        nullL1.className = "arrow";
        nullL1.textContent = "‚Üí";
        list1Container.appendChild(nullL1);
        const nullTextL1 = document.createElement("span");
        nullTextL1.className = "null-text";
        nullTextL1.textContent = "null";
        list1Container.appendChild(nullTextL1);

        // Render list2
        list2.forEach((val, idx) => {
          const wrapper = document.createElement("div");
          wrapper.className = "node-wrapper";
          wrapper.id = `l2-wrapper-${idx}`;
          wrapper.innerHTML = `
                    <span class="pointer-label p2" id="l2-p2-${idx}">p2</span>
                    <div class="pointer-arrow p2" id="l2-arrow-${idx}"></div>
                    <div class="node l2" id="l2-node-${idx}">${val}</div>
                `;
          list2Container.appendChild(wrapper);

          if (idx < list2.length - 1) {
            const arrow = document.createElement("span");
            arrow.className = "arrow";
            arrow.id = `l2-link-${idx}`;
            arrow.textContent = "‚Üí";
            list2Container.appendChild(arrow);
          }
        });

        // Add null at end
        const nullL2 = document.createElement("span");
        nullL2.className = "arrow";
        nullL2.textContent = "‚Üí";
        list2Container.appendChild(nullL2);
        const nullTextL2 = document.createElement("span");
        nullTextL2.className = "null-text";
        nullTextL2.textContent = "null";
        list2Container.appendChild(nullTextL2);
      }

      // Update display based on current step
      function updateDisplay() {
        const totalSteps = steps.length;
        const progress = ((currentStep + 1) / totalSteps) * 100;
        document.getElementById("progressBar").style.width = progress + "%";

        // Reset all nodes and pointers
        list1.forEach((_, idx) => {
          const node = document.getElementById(`l1-node-${idx}`);
          const p1Label = document.getElementById(`l1-p1-${idx}`);
          const p1Arrow = document.getElementById(`l1-arrow-${idx}`);

          node.classList.remove("active", "used", "comparing", "moving");
          p1Label.classList.remove("visible");
          p1Arrow.classList.remove("visible");
        });

        list2.forEach((_, idx) => {
          const node = document.getElementById(`l2-node-${idx}`);
          const p2Label = document.getElementById(`l2-p2-${idx}`);
          const p2Arrow = document.getElementById(`l2-arrow-${idx}`);

          node.classList.remove("active", "used", "comparing", "moving");
          p2Label.classList.remove("visible");
          p2Arrow.classList.remove("visible");
        });

        // Reset comparison box
        const compBox = document.getElementById("comparisonBox");
        compBox.classList.remove("active");
        document.getElementById("compareValueL1").classList.remove("winner");
        document.getElementById("compareValueL2").classList.remove("winner");
        document
          .getElementById("compareResult")
          .classList.remove("visible", "yes", "no");

        // Reset code highlights
        for (let i = 1; i <= 18; i++) {
          const line = document.getElementById(`codeLine${i}`);
          if (line) line.classList.remove("highlight");
        }

        // Apply current step
        if (currentStep >= 0 && currentStep < steps.length) {
          const step = steps[currentStep];

          // Update step display
          document.getElementById("stepPhase").textContent = `Step ${
            currentStep + 1
          } of ${totalSteps}: ${step.phase}`;
          document.getElementById("stepDescription").innerHTML =
            step.description;

          // Show p1 pointer
          if (step.p1 < list1.length) {
            document
              .getElementById(`l1-p1-${step.p1}`)
              .classList.add("visible");
            document
              .getElementById(`l1-arrow-${step.p1}`)
              .classList.add("visible");
            document
              .getElementById(`l1-node-${step.p1}`)
              .classList.add("active");
          }

          // Show p2 pointer
          if (step.p2 < list2.length) {
            document
              .getElementById(`l2-p2-${step.p2}`)
              .classList.add("visible");
            document
              .getElementById(`l2-arrow-${step.p2}`)
              .classList.add("visible");
            document
              .getElementById(`l2-node-${step.p2}`)
              .classList.add("active");
          }

          // Mark used nodes
          for (let i = 0; i < step.p1 && i < list1.length; i++) {
            document.getElementById(`l1-node-${i}`).classList.add("used");
            document.getElementById(`l1-node-${i}`).classList.remove("active");
          }
          for (let i = 0; i < step.p2 && i < list2.length; i++) {
            document.getElementById(`l2-node-${i}`).classList.add("used");
            document.getElementById(`l2-node-${i}`).classList.remove("active");
          }

          // Show comparison
          if (step.compare) {
            compBox.classList.add("active");
            document.getElementById("compareValueL1").textContent =
              step.compare.v1;
            document.getElementById("compareValueL2").textContent =
              step.compare.v2;

            const resultEl = document.getElementById("compareResult");
            resultEl.textContent =
              step.compare.result === "yes" ? "YES!" : "NO!";
            resultEl.classList.add("visible", step.compare.result);

            if (step.compare.winner === "l1") {
              document.getElementById("compareValueL1").classList.add("winner");
            } else {
              document.getElementById("compareValueL2").classList.add("winner");
            }

            // Add comparing animation to current nodes
            if (step.p1 < list1.length) {
              document
                .getElementById(`l1-node-${step.p1}`)
                .classList.add("comparing");
            }
            if (step.p2 < list2.length) {
              document
                .getElementById(`l2-node-${step.p2}`)
                .classList.add("comparing");
            }
          } else {
            document.getElementById("compareValueL1").textContent =
              step.p1 < list1.length ? list1[step.p1] : "-";
            document.getElementById("compareValueL2").textContent =
              step.p2 < list2.length ? list2[step.p2] : "-";
          }

          // Render merged list
          renderMergedList(step.merged, step.tail);

          // Highlight code lines
          if (step.codeLines) {
            step.codeLines.forEach((line) => {
              const lineEl = document.getElementById(`codeLine${line}`);
              if (lineEl) lineEl.classList.add("highlight");
            });
          }
        } else {
          document.getElementById("stepPhase").textContent = "Ready to start";
          document.getElementById("stepDescription").innerHTML =
            'Click <span class="highlight">Next</span> or <span class="highlight">Play</span> to begin';
          document.getElementById("mergedNodes").innerHTML = "";
          document.getElementById("compareValueL1").textContent = "?";
          document.getElementById("compareValueL2").textContent = "?";
        }

        // Show/hide final result
        if (currentStep === steps.length - 1) {
          document.getElementById("finalResult").classList.add("visible");
          animateFinalResult();
        } else {
          document.getElementById("finalResult").classList.remove("visible");
          document
            .querySelectorAll(".final-node")
            .forEach((n) => n.classList.remove("visible"));
          document
            .querySelectorAll(".final-arrow")
            .forEach((a) => a.classList.remove("visible"));
        }

        updateButtons();
      }

      // Render merged list
      function renderMergedList(merged, tailIdx) {
        const container = document.getElementById("mergedNodes");
        container.innerHTML = "";

        merged.forEach((item, idx) => {
          const node = document.createElement("div");
          node.className = `merged-node ${
            item.from === "dummy" ? "dummy-node" : "from-" + item.from
          }`;
          node.textContent = item.val;

          // Add visible class with slight delay for animation
          setTimeout(() => {
            node.classList.add("visible");
            if (idx === merged.length - 1 && idx > 0) {
              node.classList.add("new");
            }
          }, idx * 50);

          container.appendChild(node);

          // Add arrow if not last
          if (idx < merged.length - 1) {
            const arrow = document.createElement("span");
            arrow.className = "merged-arrow";
            setTimeout(() => arrow.classList.add("visible"), idx * 50 + 100);
            arrow.textContent = "‚Üí";
            container.appendChild(arrow);
          }

          // Add tail pointer indicator
          if (idx === tailIdx + 1 || (tailIdx === -1 && idx === 0)) {
            node.style.boxShadow = "0 0 20px rgba(255, 217, 61, 0.8)";
          }
        });

        // Add null at end
        const nullText = document.createElement("span");
        nullText.className = "merged-arrow";
        nullText.textContent = "‚Üí";
        setTimeout(() => nullText.classList.add("visible"), merged.length * 50);
        container.appendChild(nullText);

        const nullEnd = document.createElement("span");
        nullEnd.className = "null-text";
        nullEnd.textContent = "null";
        nullEnd.style.opacity = "0";
        setTimeout(
          () => (nullEnd.style.opacity = "0.4"),
          merged.length * 50 + 100
        );
        container.appendChild(nullEnd);
      }

      // Animate final result
      function animateFinalResult() {
        const nodes = document.querySelectorAll(".final-node");
        const arrows = document.querySelectorAll(".final-arrow");

        nodes.forEach((node, idx) => {
          setTimeout(() => {
            node.classList.add("visible");
            if (arrows[idx]) {
              setTimeout(() => arrows[idx].classList.add("visible"), 100);
            }
          }, idx * 150);
        });
      }

      // Update buttons state
      function updateButtons() {
        document.getElementById("prevBtn").disabled = currentStep < 0;
        document.getElementById("nextBtn").disabled =
          currentStep >= steps.length - 1;
      }

      // Navigation
      function nextStep() {
        if (currentStep < steps.length - 1) {
          currentStep++;
          updateDisplay();
        } else {
          stopPlay();
        }
      }

      function prevStep() {
        if (currentStep >= 0) {
          currentStep--;
          updateDisplay();
        }
      }

      function resetAnimation() {
        stopPlay();
        currentStep = -1;
        updateDisplay();
      }

      function togglePlay() {
        if (isPlaying) {
          stopPlay();
        } else {
          startPlay();
        }
      }

      function startPlay() {
        isPlaying = true;
        document.getElementById("playIcon").textContent = "‚è∏";
        document.getElementById("playText").textContent = "Pause";
        document.getElementById("playBtn").style.background =
          "linear-gradient(135deg, #ff6b9d, #cc3366)";

        playInterval = setInterval(() => {
          if (currentStep < steps.length - 1) {
            nextStep();
          } else {
            stopPlay();
          }
        }, animationSpeed);
      }

      function stopPlay() {
        isPlaying = false;
        document.getElementById("playIcon").textContent = "‚ñ∂";
        document.getElementById("playText").textContent = "Play";
        document.getElementById("playBtn").style.background =
          "linear-gradient(135deg, #00ff88, #00cc6a)";

        if (playInterval) {
          clearInterval(playInterval);
          playInterval = null;
        }
      }

      function updateSpeed() {
        animationSpeed = 3000 - document.getElementById("speedSlider").value;
        if (isPlaying) {
          stopPlay();
          startPlay();
        }
      }

      // Keyboard controls
      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight" || e.key === " ") {
          e.preventDefault();
          nextStep();
        } else if (e.key === "ArrowLeft") {
          e.preventDefault();
          prevStep();
        } else if (e.key === "p" || e.key === "P") {
          togglePlay();
        } else if (e.key === "r" || e.key === "R") {
          resetAnimation();
        }
      });

      // Initialize on load
      init();
    </script>
  </body>
</html>
