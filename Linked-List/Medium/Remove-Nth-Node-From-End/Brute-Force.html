<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üîó Remove Nth Node - Brute Force Visualization</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-primary: #0f0f1a;
        --bg-secondary: #1a1a2e;
        --bg-card: #16213e;
        --accent-cyan: #00fff5;
        --accent-pink: #ff006e;
        --accent-yellow: #ffbe0b;
        --accent-green: #06d6a0;
        --accent-purple: #8338ec;
        --accent-orange: #fb5607;
        --text-primary: #ffffff;
        --text-secondary: #a0a0b0;
        --node-default: #3a3a5c;
        --node-current: #00fff5;
        --node-target: #ff006e;
        --node-removed: #ff006e33;
        --arrow-color: #6c6c8a;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Fredoka", sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* Animated background */
      .bg-pattern {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at 20% 80%,
            rgba(131, 56, 236, 0.15) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(0, 255, 245, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 40% 40%,
            rgba(255, 0, 110, 0.08) 0%,
            transparent 40%
          );
        pointer-events: none;
        z-index: 0;
      }

      .container {
        position: relative;
        z-index: 1;
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
      }

      /* Header */
      header {
        text-align: center;
        margin-bottom: 2rem;
        animation: fadeInDown 0.8s ease-out;
      }

      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h1 {
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(
          135deg,
          var(--accent-cyan),
          var(--accent-pink)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.5rem;
      }

      .subtitle {
        font-size: 1.2rem;
        color: var(--text-secondary);
        font-weight: 400;
      }

      .badge {
        display: inline-block;
        background: linear-gradient(
          135deg,
          var(--accent-orange),
          var(--accent-pink)
        );
        padding: 0.4rem 1rem;
        border-radius: 50px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-top: 1rem;
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      /* Problem info card */
      .problem-card {
        background: var(--bg-card);
        border-radius: 20px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        animation: fadeIn 0.8s ease-out 0.2s both;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .problem-card h3 {
        color: var(--accent-yellow);
        font-size: 1.1rem;
        margin-bottom: 0.8rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .problem-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }

      .info-item {
        background: var(--bg-secondary);
        padding: 1rem;
        border-radius: 12px;
        text-align: center;
      }

      .info-label {
        font-size: 0.8rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 0.3rem;
      }

      .info-value {
        font-family: "JetBrains Mono", monospace;
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--accent-cyan);
      }

      /* Main visualization area */
      .visualization-area {
        background: var(--bg-card);
        border-radius: 24px;
        padding: 2rem;
        margin-bottom: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        animation: fadeIn 0.8s ease-out 0.4s both;
      }

      .phase-indicator {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }

      .phase {
        padding: 0.6rem 1.2rem;
        border-radius: 50px;
        font-size: 0.9rem;
        font-weight: 500;
        background: var(--bg-secondary);
        color: var(--text-secondary);
        transition: all 0.3s ease;
        border: 2px solid transparent;
      }

      .phase.active {
        background: linear-gradient(
          135deg,
          var(--accent-purple),
          var(--accent-pink)
        );
        color: white;
        border-color: var(--accent-cyan);
        box-shadow: 0 0 20px rgba(131, 56, 236, 0.4);
      }

      .phase.completed {
        background: var(--accent-green);
        color: var(--bg-primary);
      }

      /* Linked List visualization */
      .linked-list-container {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 3rem 1rem;
        overflow-x: auto;
        min-height: 180px;
      }

      .node-wrapper {
        display: flex;
        align-items: center;
        animation: nodeAppear 0.5s ease-out both;
      }

      @keyframes nodeAppear {
        from {
          opacity: 0;
          transform: scale(0.5);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .node {
        width: 70px;
        height: 70px;
        background: var(--node-default);
        border-radius: 16px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-family: "JetBrains Mono", monospace;
        font-size: 1.5rem;
        font-weight: 600;
        position: relative;
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        border: 3px solid transparent;
      }

      .node.current {
        background: linear-gradient(135deg, #00fff5, #00b4d8);
        border-color: var(--accent-cyan);
        box-shadow: 0 0 30px rgba(0, 255, 245, 0.5);
        transform: scale(1.15);
        color: var(--bg-primary);
      }

      .node.target {
        background: linear-gradient(
          135deg,
          var(--accent-pink),
          var(--accent-orange)
        );
        border-color: var(--accent-pink);
        box-shadow: 0 0 30px rgba(255, 0, 110, 0.5);
        animation: targetPulse 1s ease-in-out infinite;
      }

      @keyframes targetPulse {
        0%,
        100% {
          box-shadow: 0 0 30px rgba(255, 0, 110, 0.5);
        }
        50% {
          box-shadow: 0 0 50px rgba(255, 0, 110, 0.8);
        }
      }

      .node.removed {
        background: var(--node-removed);
        border: 3px dashed var(--accent-pink);
        opacity: 0.4;
        transform: scale(0.9);
        text-decoration: line-through;
      }

      .node.predecessor {
        background: linear-gradient(
          135deg,
          var(--accent-yellow),
          var(--accent-orange)
        );
        border-color: var(--accent-yellow);
        box-shadow: 0 0 25px rgba(255, 190, 11, 0.5);
        color: var(--bg-primary);
      }

      .node-index {
        position: absolute;
        top: -25px;
        font-size: 0.7rem;
        color: var(--text-secondary);
        background: var(--bg-secondary);
        padding: 2px 8px;
        border-radius: 10px;
      }

      .node-label {
        position: absolute;
        bottom: -30px;
        font-size: 0.65rem;
        color: var(--accent-cyan);
        font-weight: 500;
        white-space: nowrap;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .arrow {
        width: 50px;
        height: 4px;
        background: var(--arrow-color);
        position: relative;
        margin: 0 5px;
        transition: all 0.3s ease;
      }

      .arrow::after {
        content: "";
        position: absolute;
        right: -2px;
        top: 50%;
        transform: translateY(-50%);
        border: 6px solid transparent;
        border-left-color: var(--arrow-color);
      }

      .arrow.highlight {
        background: var(--accent-green);
        height: 5px;
      }

      .arrow.highlight::after {
        border-left-color: var(--accent-green);
      }

      .arrow.rewire {
        background: var(--accent-yellow);
        animation: arrowPulse 0.5s ease-in-out infinite;
      }

      .arrow.rewire::after {
        border-left-color: var(--accent-yellow);
      }

      @keyframes arrowPulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .null-node {
        font-family: "JetBrains Mono", monospace;
        font-size: 1rem;
        color: var(--text-secondary);
        padding: 0.5rem 1rem;
        background: var(--bg-secondary);
        border-radius: 8px;
        border: 2px dashed var(--text-secondary);
      }

      /* Step info panel */
      .step-panel {
        background: var(--bg-secondary);
        border-radius: 16px;
        padding: 1.5rem;
        margin-top: 2rem;
      }

      .step-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .step-number {
        font-size: 1rem;
        color: var(--accent-purple);
        font-weight: 600;
      }

      .step-counter {
        font-family: "JetBrains Mono", monospace;
        background: var(--bg-card);
        padding: 0.4rem 1rem;
        border-radius: 8px;
        font-size: 0.9rem;
      }

      .step-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .step-description {
        color: var(--text-secondary);
        line-height: 1.6;
        font-size: 1rem;
      }

      /* Variables display */
      .variables-panel {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 1rem;
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .variable {
        background: var(--bg-card);
        padding: 1rem;
        border-radius: 12px;
        text-align: center;
        transition: all 0.3s ease;
      }

      .variable.highlight {
        border: 2px solid var(--accent-cyan);
        box-shadow: 0 0 15px rgba(0, 255, 245, 0.3);
      }

      .var-name {
        font-family: "JetBrains Mono", monospace;
        font-size: 0.8rem;
        color: var(--accent-pink);
        margin-bottom: 0.3rem;
      }

      .var-value {
        font-family: "JetBrains Mono", monospace;
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--accent-cyan);
      }

      /* Controls */
      .controls {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 2rem;
        flex-wrap: wrap;
      }

      .btn {
        padding: 0.8rem 1.5rem;
        border: none;
        border-radius: 12px;
        font-family: "Fredoka", sans-serif;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--accent-cyan),
          var(--accent-green)
        );
        color: var(--bg-primary);
      }

      .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(0, 255, 245, 0.3);
      }

      .btn-secondary {
        background: var(--bg-secondary);
        color: var(--text-primary);
        border: 2px solid var(--accent-purple);
      }

      .btn-secondary:hover:not(:disabled) {
        background: var(--accent-purple);
      }

      .btn-danger {
        background: linear-gradient(
          135deg,
          var(--accent-pink),
          var(--accent-orange)
        );
        color: white;
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* Code panel */
      .code-panel {
        background: var(--bg-card);
        border-radius: 20px;
        padding: 1.5rem;
        margin-top: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        animation: fadeIn 0.8s ease-out 0.6s both;
      }

      .code-panel h3 {
        color: var(--accent-green);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .code-block {
        background: var(--bg-primary);
        border-radius: 12px;
        padding: 1rem;
        overflow-x: auto;
        font-family: "JetBrains Mono", monospace;
        font-size: 0.85rem;
        line-height: 1.8;
      }

      .code-line {
        padding: 2px 8px;
        border-radius: 4px;
        transition: all 0.3s ease;
        white-space: pre;
      }

      .code-line.active {
        background: rgba(0, 255, 245, 0.2);
        border-left: 3px solid var(--accent-cyan);
      }

      .code-comment {
        color: #6a9955;
      }

      .code-keyword {
        color: var(--accent-pink);
      }

      .code-variable {
        color: var(--accent-cyan);
      }

      .code-number {
        color: var(--accent-yellow);
      }

      .code-operator {
        color: var(--text-secondary);
      }

      /* Legend */
      .legend {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-top: 2rem;
        flex-wrap: wrap;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.85rem;
        color: var(--text-secondary);
      }

      .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 6px;
      }

      .legend-color.current {
        background: linear-gradient(135deg, #00fff5, #00b4d8);
      }

      .legend-color.target {
        background: linear-gradient(
          135deg,
          var(--accent-pink),
          var(--accent-orange)
        );
      }

      .legend-color.predecessor {
        background: linear-gradient(
          135deg,
          var(--accent-yellow),
          var(--accent-orange)
        );
      }

      /* Progress bar */
      .progress-container {
        margin-top: 1.5rem;
        background: var(--bg-secondary);
        border-radius: 10px;
        height: 8px;
        overflow: hidden;
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--accent-cyan),
          var(--accent-green)
        );
        border-radius: 10px;
        transition: width 0.5s ease;
      }

      /* Completion message */
      .completion-message {
        text-align: center;
        padding: 2rem;
        animation: celebrateIn 0.5s ease-out;
      }

      @keyframes celebrateIn {
        from {
          opacity: 0;
          transform: scale(0.8);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .completion-emoji {
        font-size: 4rem;
        animation: bounce 1s ease-in-out infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-20px);
        }
      }

      .completion-title {
        font-size: 1.8rem;
        margin: 1rem 0;
        background: linear-gradient(
          135deg,
          var(--accent-green),
          var(--accent-cyan)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* Responsive */
      @media (max-width: 768px) {
        h1 {
          font-size: 1.8rem;
        }

        .node {
          width: 55px;
          height: 55px;
          font-size: 1.2rem;
        }

        .arrow {
          width: 30px;
        }

        .controls {
          flex-direction: column;
          align-items: stretch;
        }

        .btn {
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="bg-pattern"></div>

    <div class="container">
      <header>
        <h1>üîó Remove Nth Node From End</h1>
        <p class="subtitle">
          Brute Force Approach - Step by Step Visualization
        </p>
        <span class="badge">üìö Two-Pass Algorithm</span>
      </header>

      <!-- Problem Info -->
      <div class="problem-card">
        <h3>üìã Problem Instance</h3>
        <div class="problem-info">
          <div class="info-item">
            <div class="info-label">Input List</div>
            <div class="info-value">[1, 2, 3, 4, 5]</div>
          </div>
          <div class="info-item">
            <div class="info-label">N (from end)</div>
            <div class="info-value">2</div>
          </div>
          <div class="info-item">
            <div class="info-label">Target Node</div>
            <div class="info-value">4</div>
          </div>
          <div class="info-item">
            <div class="info-label">Expected Output</div>
            <div class="info-value">[1, 2, 3, 5]</div>
          </div>
        </div>
      </div>

      <!-- Main Visualization -->
      <div class="visualization-area">
        <!-- Phase Indicators -->
        <div class="phase-indicator">
          <span class="phase" id="phase1">üìè Pass 1: Count Nodes</span>
          <span class="phase" id="phase2">üßÆ Calculate Position</span>
          <span class="phase" id="phase3">üîç Pass 2: Find Predecessor</span>
          <span class="phase" id="phase4">‚úÇÔ∏è Remove Node</span>
        </div>

        <!-- Linked List -->
        <div class="linked-list-container" id="linkedList">
          <!-- Nodes will be rendered here -->
        </div>

        <!-- Step Info -->
        <div class="step-panel">
          <div class="step-header">
            <span class="step-number" id="stepPhase">Phase 1</span>
            <span class="step-counter" id="stepCounter">Step 0 / 14</span>
          </div>
          <div class="step-title" id="stepTitle">üöÄ Ready to Start</div>
          <div class="step-description" id="stepDescription">
            Click "Next Step" to begin the brute force algorithm visualization.
            We'll first count all nodes, then find and remove the target.
          </div>

          <!-- Variables -->
          <div class="variables-panel" id="variablesPanel">
            <div class="variable" id="varLength">
              <div class="var-name">length</div>
              <div class="var-value">0</div>
            </div>
            <div class="variable" id="varN">
              <div class="var-name">n</div>
              <div class="var-value">2</div>
            </div>
            <div class="variable" id="varCurrent">
              <div class="var-name">current</div>
              <div class="var-value">head</div>
            </div>
            <div class="variable" id="varSteps">
              <div class="var-name">stepsToTake</div>
              <div class="var-value">‚Äî</div>
            </div>
          </div>

          <!-- Progress -->
          <div class="progress-container">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
          </div>
        </div>

        <!-- Controls -->
        <div class="controls">
          <button class="btn btn-secondary" id="prevBtn" disabled>
            ‚¨ÖÔ∏è Previous
          </button>
          <button class="btn btn-primary" id="nextBtn">Next Step ‚û°Ô∏è</button>
          <button class="btn btn-secondary" id="autoBtn">‚ñ∂Ô∏è Auto Play</button>
          <button class="btn btn-danger" id="resetBtn">üîÑ Reset</button>
        </div>

        <!-- Legend -->
        <div class="legend">
          <div class="legend-item">
            <div class="legend-color current"></div>
            <span>Current Node</span>
          </div>
          <div class="legend-item">
            <div class="legend-color target"></div>
            <span>Target (to remove)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color predecessor"></div>
            <span>Predecessor</span>
          </div>
        </div>
      </div>

      <!-- Code Panel -->
      <div class="code-panel">
        <h3>üíª Algorithm Code</h3>
        <div class="code-block" id="codeBlock">
          <div class="code-line" data-line="1">
            <span class="code-keyword">function</span>
            <span class="code-variable">removeNthFromEnd</span>(head, n) {
          </div>
          <div class="code-line" data-line="2">
            <span class="code-comment">// PASS 1: Count total nodes</span>
          </div>
          <div class="code-line" data-line="3">
            <span class="code-keyword">let</span>
            <span class="code-variable">length</span> =
            <span class="code-number">0</span>;
          </div>
          <div class="code-line" data-line="4">
            <span class="code-keyword">let</span>
            <span class="code-variable">current</span> = head;
          </div>
          <div class="code-line" data-line="5">
            <span class="code-keyword">while</span> (current !==
            <span class="code-keyword">null</span>) {
          </div>
          <div class="code-line" data-line="6">length++;</div>
          <div class="code-line" data-line="7">current = current.next;</div>
          <div class="code-line" data-line="8">}</div>
          <div class="code-line" data-line="9"></div>
          <div class="code-line" data-line="10">
            <span class="code-comment">// Calculate steps to predecessor</span>
          </div>
          <div class="code-line" data-line="11">
            <span class="code-keyword">const</span>
            <span class="code-variable">stepsToTake</span> = length - n -
            <span class="code-number">1</span>;
          </div>
          <div class="code-line" data-line="12"></div>
          <div class="code-line" data-line="13">
            <span class="code-comment">// PASS 2: Find predecessor</span>
          </div>
          <div class="code-line" data-line="14">current = head;</div>
          <div class="code-line" data-line="15">
            <span class="code-keyword">for</span> (<span class="code-keyword"
              >let</span
            >
            i = <span class="code-number">0</span>; i < stepsToTake; i++) {
          </div>
          <div class="code-line" data-line="16">current = current.next;</div>
          <div class="code-line" data-line="17">}</div>
          <div class="code-line" data-line="18"></div>
          <div class="code-line" data-line="19">
            <span class="code-comment">// Remove target node</span>
          </div>
          <div class="code-line" data-line="20">
            current.next = current.next.next;
          </div>
          <div class="code-line" data-line="21">
            <span class="code-keyword">return</span> head;
          </div>
          <div class="code-line" data-line="22">}</div>
        </div>
      </div>
    </div>

    <script>
      // Algorithm state
      const initialList = [1, 2, 3, 4, 5];
      const n = 2;
      let currentStep = 0;
      let isAutoPlaying = false;
      let autoPlayInterval = null;

      // Define all steps
      const steps = [
        // Step 0: Initial state
        {
          phase: 0,
          title: "üöÄ Ready to Start",
          description:
            "We have a linked list [1‚Üí2‚Üí3‚Üí4‚Üí5] and need to remove the 2nd node from the end (which is node 4). The brute force approach uses TWO passes through the list.",
          currentNode: null,
          targetNode: null,
          predecessorNode: null,
          length: 0,
          current: "head",
          stepsToTake: "‚Äî",
          codeLine: null,
          removedNode: null,
        },
        // Pass 1: Counting
        {
          phase: 1,
          title: "üìè Initialize Counter",
          description:
            "Set length = 0 and current = head. We'll traverse the entire list to count how many nodes exist.",
          currentNode: 0,
          targetNode: null,
          predecessorNode: null,
          length: 0,
          current: "1",
          stepsToTake: "‚Äî",
          codeLine: [3, 4],
        },
        {
          phase: 1,
          title: "üìè Count Node 1",
          description:
            "current points to node 1 (not null), so increment length to 1, then move current to the next node.",
          currentNode: 0,
          targetNode: null,
          predecessorNode: null,
          length: 1,
          current: "1‚Üí2",
          stepsToTake: "‚Äî",
          codeLine: [5, 6, 7],
        },
        {
          phase: 1,
          title: "üìè Count Node 2",
          description:
            "current points to node 2 (not null), so increment length to 2, then move current to the next node.",
          currentNode: 1,
          targetNode: null,
          predecessorNode: null,
          length: 2,
          current: "2‚Üí3",
          stepsToTake: "‚Äî",
          codeLine: [5, 6, 7],
        },
        {
          phase: 1,
          title: "üìè Count Node 3",
          description:
            "current points to node 3 (not null), so increment length to 3, then move current to the next node.",
          currentNode: 2,
          targetNode: null,
          predecessorNode: null,
          length: 3,
          current: "3‚Üí4",
          stepsToTake: "‚Äî",
          codeLine: [5, 6, 7],
        },
        {
          phase: 1,
          title: "üìè Count Node 4",
          description:
            "current points to node 4 (not null), so increment length to 4, then move current to the next node.",
          currentNode: 3,
          targetNode: null,
          predecessorNode: null,
          length: 4,
          current: "4‚Üí5",
          stepsToTake: "‚Äî",
          codeLine: [5, 6, 7],
        },
        {
          phase: 1,
          title: "üìè Count Node 5",
          description:
            "current points to node 5 (not null), so increment length to 5, then move current to null (end of list).",
          currentNode: 4,
          targetNode: null,
          predecessorNode: null,
          length: 5,
          current: "5‚Üínull",
          stepsToTake: "‚Äî",
          codeLine: [5, 6, 7],
        },
        {
          phase: 1,
          title: "‚úÖ Pass 1 Complete!",
          description:
            "current is now null, so we exit the while loop. We've counted 5 nodes total. Now we know the list length!",
          currentNode: null,
          targetNode: null,
          predecessorNode: null,
          length: 5,
          current: "null",
          stepsToTake: "‚Äî",
          codeLine: [8],
        },
        // Phase 2: Calculate
        {
          phase: 2,
          title: "üßÆ Calculate Position",
          description:
            "The target is the 2nd node from end. To find its PREDECESSOR, we need: stepsToTake = length - n - 1 = 5 - 2 - 1 = 2 steps from head.",
          currentNode: null,
          targetNode: 3,
          predecessorNode: null,
          length: 5,
          current: "‚Äî",
          stepsToTake: 2,
          codeLine: [10, 11],
        },
        // Pass 2: Find predecessor
        {
          phase: 3,
          title: "üîç Reset to Head",
          description:
            "Start Pass 2: Reset current to head. We need to take 2 steps to reach the predecessor of our target node.",
          currentNode: 0,
          targetNode: 3,
          predecessorNode: null,
          length: 5,
          current: "1",
          stepsToTake: 2,
          codeLine: [13, 14],
        },
        {
          phase: 3,
          title: "üîç Step 1 of 2",
          description:
            "Take step 1: Move current from node 1 to node 2. One more step to go!",
          currentNode: 1,
          targetNode: 3,
          predecessorNode: null,
          length: 5,
          current: "2",
          stepsToTake: "2 (i=0)",
          codeLine: [15, 16],
        },
        {
          phase: 3,
          title: "üîç Step 2 of 2",
          description:
            "Take step 2: Move current from node 2 to node 3. We've taken all required steps!",
          currentNode: 2,
          targetNode: 3,
          predecessorNode: 2,
          length: 5,
          current: "3",
          stepsToTake: "2 (i=1)",
          codeLine: [15, 16],
        },
        {
          phase: 3,
          title: "üéØ Found Predecessor!",
          description:
            "Loop complete! current (node 3) is the PREDECESSOR of our target. Its next pointer points to node 4, which we need to remove.",
          currentNode: null,
          targetNode: 3,
          predecessorNode: 2,
          length: 5,
          current: "3 ‚úì",
          stepsToTake: "done",
          codeLine: [17],
        },
        // Phase 4: Remove
        {
          phase: 4,
          title: "‚úÇÔ∏è Rewire Pointers",
          description:
            "Execute: current.next = current.next.next. This makes node 3 point directly to node 5, bypassing (removing) node 4!",
          currentNode: null,
          targetNode: 3,
          predecessorNode: 2,
          removedNode: 3,
          length: 5,
          current: "3",
          stepsToTake: "done",
          codeLine: [19, 20],
        },
        {
          phase: 4,
          title: "üéâ Complete!",
          description:
            "Node 4 has been removed! The final list is [1‚Üí2‚Üí3‚Üí5]. We used 2 passes: first to count (5 steps), then to find predecessor (2 steps).",
          currentNode: null,
          targetNode: null,
          predecessorNode: null,
          removedNode: 3,
          length: 5,
          current: "‚Äî",
          stepsToTake: "‚Äî",
          codeLine: [21],
          complete: true,
        },
      ];

      // DOM Elements
      const linkedListEl = document.getElementById("linkedList");
      const stepTitleEl = document.getElementById("stepTitle");
      const stepDescriptionEl = document.getElementById("stepDescription");
      const stepPhaseEl = document.getElementById("stepPhase");
      const stepCounterEl = document.getElementById("stepCounter");
      const progressBarEl = document.getElementById("progressBar");
      const variablesPanelEl = document.getElementById("variablesPanel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const autoBtn = document.getElementById("autoBtn");
      const resetBtn = document.getElementById("resetBtn");
      const codeBlockEl = document.getElementById("codeBlock");

      // Phase elements
      const phases = [
        document.getElementById("phase1"),
        document.getElementById("phase2"),
        document.getElementById("phase3"),
        document.getElementById("phase4"),
      ];

      // Render linked list
      function renderList(step) {
        linkedListEl.innerHTML = "";

        const state = steps[step];
        const isRemoved = state.removedNode !== undefined;

        initialList.forEach((value, index) => {
          // Skip removed node in final state
          if (state.complete && index === 3) return;

          const wrapper = document.createElement("div");
          wrapper.className = "node-wrapper";
          wrapper.style.animationDelay = `${index * 0.1}s`;

          const node = document.createElement("div");
          node.className = "node";
          node.textContent = value;

          // Add index label
          const indexLabel = document.createElement("span");
          indexLabel.className = "node-index";
          indexLabel.textContent = `idx ${index}`;
          node.appendChild(indexLabel);

          // Apply states
          if (state.currentNode === index) {
            node.classList.add("current");
            const label = document.createElement("span");
            label.className = "node-label";
            label.textContent = "üëÜ current";
            node.appendChild(label);
          }

          if (state.targetNode === index) {
            node.classList.add("target");
            if (state.currentNode !== index) {
              const label = document.createElement("span");
              label.className = "node-label";
              label.textContent = "üéØ target";
              node.appendChild(label);
            }
          }

          if (state.predecessorNode === index && state.currentNode !== index) {
            node.classList.add("predecessor");
            const label = document.createElement("span");
            label.className = "node-label";
            label.textContent = "üìç predecessor";
            node.appendChild(label);
          }

          if (isRemoved && index === 3 && !state.complete) {
            node.classList.add("removed");
            const label = document.createElement("span");
            label.className = "node-label";
            label.textContent = "‚ùå removed";
            node.appendChild(label);
          }

          wrapper.appendChild(node);

          // Add arrow (except for last node or removed visualization)
          if (index < initialList.length - 1) {
            if (!(state.complete && index === 2)) {
              const arrow = document.createElement("div");
              arrow.className = "arrow";

              // Highlight rewiring
              if (isRemoved && index === 2) {
                arrow.classList.add("rewire");
              }

              wrapper.appendChild(arrow);
            }
          }

          linkedListEl.appendChild(wrapper);
        });

        // Add null at the end
        const nullWrapper = document.createElement("div");
        nullWrapper.className = "node-wrapper";
        const nullNode = document.createElement("div");
        nullNode.className = "null-node";
        nullNode.textContent = "null";
        nullWrapper.appendChild(nullNode);
        linkedListEl.appendChild(nullWrapper);
      }

      // Update variables panel
      function updateVariables(step) {
        const state = steps[step];

        document.querySelector("#varLength .var-value").textContent =
          state.length;
        document.querySelector("#varN .var-value").textContent = n;
        document.querySelector("#varCurrent .var-value").textContent =
          state.current;
        document.querySelector("#varSteps .var-value").textContent =
          state.stepsToTake;

        // Highlight changed variables
        document
          .querySelectorAll(".variable")
          .forEach((v) => v.classList.remove("highlight"));

        if (step > 0) {
          const prevState = steps[step - 1];
          if (state.length !== prevState.length) {
            document.getElementById("varLength").classList.add("highlight");
          }
          if (state.current !== prevState.current) {
            document.getElementById("varCurrent").classList.add("highlight");
          }
          if (state.stepsToTake !== prevState.stepsToTake) {
            document.getElementById("varSteps").classList.add("highlight");
          }
        }
      }

      // Update phase indicators
      function updatePhases(step) {
        const state = steps[step];

        phases.forEach((phase, index) => {
          phase.classList.remove("active", "completed");

          if (index + 1 === state.phase) {
            phase.classList.add("active");
          } else if (index + 1 < state.phase) {
            phase.classList.add("completed");
          }
        });
      }

      // Update code highlighting
      function updateCode(step) {
        const state = steps[step];

        document.querySelectorAll(".code-line").forEach((line) => {
          line.classList.remove("active");
        });

        if (state.codeLine) {
          state.codeLine.forEach((lineNum) => {
            const line = document.querySelector(
              `.code-line[data-line="${lineNum}"]`
            );
            if (line) line.classList.add("active");
          });
        }
      }

      // Main render function
      function render() {
        const state = steps[currentStep];

        renderList(currentStep);
        updateVariables(currentStep);
        updatePhases(currentStep);
        updateCode(currentStep);

        // Update step info
        stepTitleEl.textContent = state.title;
        stepDescriptionEl.textContent = state.description;
        stepPhaseEl.textContent =
          state.phase > 0 ? `Phase ${state.phase}` : "Start";
        stepCounterEl.textContent = `Step ${currentStep} / ${steps.length - 1}`;

        // Update progress
        const progress = (currentStep / (steps.length - 1)) * 100;
        progressBarEl.style.width = `${progress}%`;

        // Update buttons
        prevBtn.disabled = currentStep === 0;
        nextBtn.disabled = currentStep === steps.length - 1;

        // Show completion message
        if (state.complete) {
          showCompletion();
        }
      }

      // Show completion celebration
      function showCompletion() {
        if (document.querySelector(".completion-message")) return;

        const completion = document.createElement("div");
        completion.className = "completion-message";
        completion.innerHTML = `
                <div class="completion-emoji">üéâ</div>
                <div class="completion-title">Algorithm Complete!</div>
                <p style="color: var(--text-secondary);">Successfully removed node 4 from the list.<br>Final result: [1, 2, 3, 5]</p>
            `;

        document.querySelector(".step-panel").appendChild(completion);
      }

      // Event handlers
      function goToStep(step) {
        currentStep = Math.max(0, Math.min(step, steps.length - 1));

        // Remove completion message if going back
        const completion = document.querySelector(".completion-message");
        if (completion && currentStep < steps.length - 1) {
          completion.remove();
        }

        render();
      }

      prevBtn.addEventListener("click", () => goToStep(currentStep - 1));
      nextBtn.addEventListener("click", () => goToStep(currentStep + 1));

      autoBtn.addEventListener("click", () => {
        if (isAutoPlaying) {
          clearInterval(autoPlayInterval);
          autoBtn.textContent = "‚ñ∂Ô∏è Auto Play";
          isAutoPlaying = false;
        } else {
          if (currentStep === steps.length - 1) {
            goToStep(0);
          }
          isAutoPlaying = true;
          autoBtn.textContent = "‚è∏Ô∏è Pause";
          autoPlayInterval = setInterval(() => {
            if (currentStep < steps.length - 1) {
              goToStep(currentStep + 1);
            } else {
              clearInterval(autoPlayInterval);
              autoBtn.textContent = "‚ñ∂Ô∏è Auto Play";
              isAutoPlaying = false;
            }
          }, 1500);
        }
      });

      resetBtn.addEventListener("click", () => {
        if (isAutoPlaying) {
          clearInterval(autoPlayInterval);
          autoBtn.textContent = "‚ñ∂Ô∏è Auto Play";
          isAutoPlaying = false;
        }

        const completion = document.querySelector(".completion-message");
        if (completion) completion.remove();

        goToStep(0);
      });

      // Keyboard navigation
      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight" || e.key === " ") {
          e.preventDefault();
          goToStep(currentStep + 1);
        } else if (e.key === "ArrowLeft") {
          e.preventDefault();
          goToStep(currentStep - 1);
        } else if (e.key === "r" || e.key === "R") {
          resetBtn.click();
        }
      });

      // Initial render
      render();
    </script>
  </body>
</html>
