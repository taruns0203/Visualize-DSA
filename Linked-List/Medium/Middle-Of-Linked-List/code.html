<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Code Snippet Manager | DSA Learning Hub</title>

    <!-- CodeMirror CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/dracula.min.css"
    />

    <!-- Prism.js for snippet preview highlighting -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #1a1a2e 0%,
          #16213e 50%,
          #0f3460 100%
        );
        min-height: 100vh;
        padding: 40px 20px;
        color: #e0e0e0;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
      }

      .header h1 {
        font-size: 2.8rem;
        color: #fff;
        text-shadow: 0 0 20px rgba(0, 217, 255, 0.5);
        margin-bottom: 10px;
        animation: glow 2s ease-in-out infinite alternate;
      }

      @keyframes glow {
        from {
          text-shadow: 0 0 20px rgba(0, 217, 255, 0.5);
        }
        to {
          text-shadow: 0 0 30px rgba(157, 78, 221, 0.8),
            0 0 40px rgba(157, 78, 221, 0.4);
        }
      }

      .header .subtitle {
        color: #a0a0a0;
        font-size: 1.1rem;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      /* Editor Section */
      .editor-section {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 24px;
        padding: 30px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 30px;
        box-shadow: 0 10px 40px rgba(0, 217, 255, 0.1);
      }

      .editor-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
      }

      .editor-title {
        display: flex;
        align-items: center;
        gap: 12px;
        color: #00d9ff;
        font-size: 1.4rem;
        font-weight: 600;
      }

      .editor-controls {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
      }

      .control-group {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .control-group label {
        color: #a0a0a0;
        font-size: 0.9rem;
      }

      select {
        padding: 10px 16px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.05);
        color: #e0e0e0;
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      select:hover,
      select:focus {
        border-color: #00d9ff;
        outline: none;
      }

      select option {
        background: #1a1a2e;
        color: #e0e0e0;
      }

      input[type="text"] {
        padding: 12px 18px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.05);
        color: #e0e0e0;
        font-size: 1rem;
        width: 250px;
        transition: all 0.3s ease;
      }

      input[type="text"]:focus {
        border-color: #00d9ff;
        outline: none;
        box-shadow: 0 0 15px rgba(0, 217, 255, 0.2);
      }

      input[type="text"]::placeholder {
        color: #606060;
      }

      .code-editor-wrapper {
        border-radius: 16px;
        overflow: hidden;
        background: #282a36;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .editor-toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 20px;
        background: rgba(255, 255, 255, 0.03);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .file-info {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #a0a0a0;
        font-size: 0.9rem;
      }

      .toolbar-buttons {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .toolbar-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 8px;
        font-size: 0.85rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .btn-format {
        background: rgba(255, 217, 61, 0.2);
        color: #ffd93d;
      }
      .btn-format:hover {
        background: rgba(255, 217, 61, 0.3);
      }

      .btn-copy {
        background: rgba(0, 217, 255, 0.2);
        color: #00d9ff;
      }
      .btn-copy:hover {
        background: rgba(0, 217, 255, 0.3);
      }

      .btn-clear {
        background: rgba(255, 107, 107, 0.2);
        color: #ff6b6b;
      }
      .btn-clear:hover {
        background: rgba(255, 107, 107, 0.3);
      }

      .btn-save {
        background: rgba(0, 255, 127, 0.2);
        color: #00ff7f;
      }
      .btn-save:hover {
        background: rgba(0, 255, 127, 0.3);
      }

      .btn-download {
        background: rgba(157, 78, 221, 0.2);
        color: #9d4edd;
      }
      .btn-download:hover {
        background: rgba(157, 78, 221, 0.3);
      }

      /* CodeMirror Customization */
      .CodeMirror {
        height: 400px;
        font-size: 14px;
        font-family: "Fira Code", "JetBrains Mono", "Consolas", monospace;
        border-radius: 0 0 16px 16px;
      }

      .CodeMirror-gutters {
        background: #21222c;
        border-right: 1px solid #44475a;
      }

      .CodeMirror-linenumber {
        color: #6272a4;
      }

      /* Saved Snippets Section */
      .snippets-section {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 24px;
        padding: 30px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .snippets-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        flex-wrap: wrap;
        gap: 15px;
      }

      .snippets-title {
        display: flex;
        align-items: center;
        gap: 12px;
        color: #ffd93d;
        font-size: 1.4rem;
        font-weight: 600;
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .search-box {
        position: relative;
      }

      .search-box input {
        padding: 10px 18px 10px 40px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.05);
        color: #e0e0e0;
        font-size: 0.9rem;
        width: 200px;
        transition: all 0.3s ease;
      }

      .search-box input:focus {
        border-color: #ffd93d;
        outline: none;
        width: 250px;
      }

      .search-box::before {
        content: "üîç";
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 0.9rem;
      }

      .snippet-count {
        background: rgba(255, 217, 61, 0.2);
        color: #ffd93d;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
      }

      .snippets-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
        gap: 20px;
      }

      .snippet-card {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .snippet-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        border-color: rgba(255, 255, 255, 0.2);
      }

      .snippet-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: rgba(255, 255, 255, 0.03);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .snippet-info {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .snippet-name {
        color: #fff;
        font-weight: 600;
        font-size: 1rem;
      }

      .snippet-meta {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 0.8rem;
        color: #a0a0a0;
      }

      .lang-badge {
        padding: 3px 10px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .lang-javascript {
        background: rgba(255, 217, 61, 0.2);
        color: #ffd93d;
      }
      .lang-typescript {
        background: rgba(0, 122, 204, 0.2);
        color: #3178c6;
      }
      .lang-python {
        background: rgba(55, 118, 171, 0.2);
        color: #3776ab;
      }
      .lang-java {
        background: rgba(255, 107, 107, 0.2);
        color: #ff6b6b;
      }
      .lang-cpp {
        background: rgba(157, 78, 221, 0.2);
        color: #9d4edd;
      }
      .lang-c {
        background: rgba(85, 85, 85, 0.2);
        color: #a8b9cc;
      }
      .lang-html {
        background: rgba(227, 76, 38, 0.2);
        color: #e34c26;
      }
      .lang-css {
        background: rgba(38, 77, 228, 0.2);
        color: #264de4;
      }
      .lang-sql {
        background: rgba(0, 188, 212, 0.2);
        color: #00bcd4;
      }
      .lang-go {
        background: rgba(0, 173, 216, 0.2);
        color: #00add8;
      }
      .lang-rust {
        background: rgba(222, 165, 132, 0.2);
        color: #dea584;
      }
      .lang-other {
        background: rgba(255, 255, 255, 0.1);
        color: #a0a0a0;
      }

      .snippet-actions {
        display: flex;
        gap: 8px;
      }

      .action-btn {
        width: 32px;
        height: 32px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        transition: all 0.3s ease;
      }

      .action-btn.load {
        background: rgba(0, 217, 255, 0.2);
        color: #00d9ff;
      }
      .action-btn.load:hover {
        background: rgba(0, 217, 255, 0.4);
      }

      .action-btn.delete {
        background: rgba(255, 107, 107, 0.2);
        color: #ff6b6b;
      }
      .action-btn.delete:hover {
        background: rgba(255, 107, 107, 0.4);
      }

      .snippet-preview {
        padding: 0;
        max-height: 150px;
        overflow: hidden;
        position: relative;
        background: #1e1e1e;
      }

      .snippet-preview pre {
        margin: 0;
        padding: 15px;
        font-size: 12px;
        line-height: 1.5;
      }

      .snippet-preview pre code {
        font-family: "Fira Code", "Consolas", monospace;
      }

      .snippet-preview::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 50px;
        background: linear-gradient(transparent, #1e1e1e);
        pointer-events: none;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #606060;
        grid-column: 1 / -1;
      }

      .empty-state .icon {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.5;
      }

      .empty-state h3 {
        color: #a0a0a0;
        margin-bottom: 10px;
      }

      /* Toast Notification */
      .toast {
        position: fixed;
        bottom: 30px;
        right: 30px;
        padding: 16px 24px;
        border-radius: 12px;
        color: #fff;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 10px;
        transform: translateX(400px);
        transition: transform 0.3s ease;
        z-index: 1000;
      }

      .toast.show {
        transform: translateX(0);
      }

      .toast.success {
        background: linear-gradient(90deg, #00ff7f, #50fa7b);
        color: #1a1a2e;
      }

      .toast.error {
        background: linear-gradient(90deg, #ff6b6b, #ff8e8e);
        color: #1a1a2e;
      }

      .toast.info {
        background: linear-gradient(90deg, #00d9ff, #50e3ff);
        color: #1a1a2e;
      }

      /* Stats Bar */
      .stats-bar {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-bottom: 40px;
        flex-wrap: wrap;
      }

      .stat-item {
        background: rgba(255, 255, 255, 0.03);
        padding: 15px 30px;
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        text-align: center;
      }

      .stat-item .value {
        font-size: 2rem;
        font-weight: 700;
        background: linear-gradient(90deg, #00d9ff, #9d4edd);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .stat-item .label {
        color: #a0a0a0;
        font-size: 0.85rem;
        margin-top: 5px;
      }

      .footer {
        text-align: center;
        margin-top: 50px;
        color: #606060;
        font-size: 0.9rem;
      }

      @media (max-width: 600px) {
        .header h1 {
          font-size: 2rem;
        }

        .editor-header {
          flex-direction: column;
          align-items: flex-start;
        }

        .snippets-grid {
          grid-template-columns: 1fr;
        }

        input[type="text"] {
          width: 100%;
        }

        .toolbar-buttons {
          justify-content: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>üìù‚ú® Code Snippet Manager ‚ú®üìù</h1>
      <p class="subtitle">
        üöÄ Paste, format, and organize your code snippets with syntax
        highlighting üéØ
      </p>
    </div>

    <div class="container">
      <!-- Stats Bar -->
      <div class="stats-bar">
        <div class="stat-item">
          <div class="value" id="totalSnippets">0</div>
          <div class="label">Total Snippets</div>
        </div>
        <div class="stat-item">
          <div class="value" id="totalLines">0</div>
          <div class="label">Lines of Code</div>
        </div>
        <div class="stat-item">
          <div class="value" id="totalLangs">0</div>
          <div class="label">Languages</div>
        </div>
      </div>

      <!-- Editor Section -->
      <div class="editor-section">
        <div class="editor-header">
          <div class="editor-title">
            <span>üíª</span>
            <span>Code Editor</span>
          </div>
          <div class="editor-controls">
            <input
              type="text"
              id="snippetName"
              placeholder="‚úèÔ∏è Snippet name..."
            />
            <div class="control-group">
              <label>üî§</label>
              <select id="languageSelect">
                <option value="javascript">JavaScript</option>
                <option value="typescript">TypeScript</option>
                <option value="python">Python</option>
                <option value="java">Java</option>
                <option value="cpp">C++</option>
                <option value="c">C</option>
                <option value="html">HTML</option>
                <option value="css">CSS</option>
                <option value="sql">SQL</option>
                <option value="go">Go</option>
                <option value="rust">Rust</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>
        </div>

        <div class="code-editor-wrapper">
          <div class="editor-toolbar">
            <div class="file-info">
              <span>üìÑ</span>
              <span id="fileInfo">Untitled.js</span>
            </div>
            <div class="toolbar-buttons">
              <button class="toolbar-btn btn-format" onclick="formatCode()">
                <span>‚ú®</span> Format
              </button>
              <button class="toolbar-btn btn-copy" onclick="copyCode()">
                <span>üìã</span> Copy
              </button>
              <button class="toolbar-btn btn-clear" onclick="clearEditor()">
                <span>üóëÔ∏è</span> Clear
              </button>
              <button class="toolbar-btn btn-save" onclick="saveSnippet()">
                <span>üíæ</span> Save
              </button>
              <button
                class="toolbar-btn btn-download"
                onclick="downloadSnippet()"
              >
                <span>‚¨áÔ∏è</span> Download
              </button>
            </div>
          </div>
          <textarea id="codeEditor"></textarea>
        </div>
      </div>

      <!-- Saved Snippets Section -->
      <div class="snippets-section">
        <div class="snippets-header">
          <div class="snippets-title">
            <span>üìÅ</span>
            <span>Saved Snippets</span>
          </div>
          <div class="header-right">
            <div class="search-box">
              <input
                type="text"
                id="searchInput"
                placeholder="Search snippets..."
              />
            </div>
            <div class="snippet-count" id="snippetCount">0 snippets</div>
          </div>
        </div>

        <div class="snippets-grid" id="snippetsGrid">
          <div class="empty-state">
            <div class="icon">üì≠</div>
            <h3>No snippets saved yet</h3>
            <p>Start by pasting some code and clicking Save!</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
      <span class="toast-icon"></span>
      <span class="toast-message"></span>
    </div>

    <div class="footer">
      üí° Tip: Your snippets are saved in your browser's local storage üíæ
    </div>

    <!-- CodeMirror JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/sql/sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/go/go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/rust/rust.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/matchbrackets.min.js"></script>

    <!-- Prism.js for snippet preview -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-rust.min.js"></script>

    <!-- Prettier for formatting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/3.2.4/standalone.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/3.2.4/plugins/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/3.2.4/plugins/html.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/3.2.4/plugins/postcss.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/3.2.4/plugins/typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/3.2.4/plugins/estree.min.js"></script>

    <script>
      // Language mode mapping for CodeMirror
      const languageModes = {
        javascript: "javascript",
        typescript: "text/typescript",
        python: "python",
        java: "text/x-java",
        cpp: "text/x-c++src",
        c: "text/x-csrc",
        html: "htmlmixed",
        css: "css",
        sql: "sql",
        go: "go",
        rust: "rust",
        other: "javascript",
      };

      // Prism language mapping
      const prismLanguages = {
        javascript: "javascript",
        typescript: "typescript",
        python: "python",
        java: "java",
        cpp: "cpp",
        c: "c",
        html: "html",
        css: "css",
        sql: "sql",
        go: "go",
        rust: "rust",
        other: "javascript",
      };

      // File extensions
      const extensions = {
        javascript: ".js",
        typescript: ".ts",
        python: ".py",
        java: ".java",
        cpp: ".cpp",
        c: ".c",
        html: ".html",
        css: ".css",
        sql: ".sql",
        go: ".go",
        rust: ".rs",
        other: ".txt",
      };

      // Initialize CodeMirror
      const editor = CodeMirror.fromTextArea(
        document.getElementById("codeEditor"),
        {
          mode: "javascript",
          theme: "dracula",
          lineNumbers: true,
          autoCloseBrackets: true,
          matchBrackets: true,
          indentUnit: 2,
          tabSize: 2,
          indentWithTabs: false,
          lineWrapping: true,
          placeholder: "// Paste your code here... ‚ú®",
        }
      );

      // Elements
      const snippetName = document.getElementById("snippetName");
      const languageSelect = document.getElementById("languageSelect");
      const snippetsGrid = document.getElementById("snippetsGrid");
      const snippetCount = document.getElementById("snippetCount");
      const fileInfo = document.getElementById("fileInfo");
      const toast = document.getElementById("toast");
      const searchInput = document.getElementById("searchInput");

      // Initialize snippets from localStorage
      let snippets = JSON.parse(localStorage.getItem("codeSnippets")) || [];

      // Update file info
      function updateFileInfo() {
        const name = snippetName.value || "Untitled";
        const ext = extensions[languageSelect.value];
        fileInfo.textContent = `${name}${ext}`;
      }

      snippetName.addEventListener("input", updateFileInfo);

      // Change language mode
      languageSelect.addEventListener("change", () => {
        const mode = languageModes[languageSelect.value];
        editor.setOption("mode", mode);
        updateFileInfo();
      });

      // Search functionality
      searchInput.addEventListener("input", () => {
        renderSnippets(searchInput.value.toLowerCase());
      });

      // Show toast notification
      function showToast(message, type = "success") {
        toast.querySelector(".toast-message").textContent = message;
        toast.className = `toast ${type} show`;

        const icons = { success: "‚úÖ", error: "‚ùå", info: "‚ÑπÔ∏è" };
        toast.querySelector(".toast-icon").textContent = icons[type];

        setTimeout(() => toast.classList.remove("show"), 3000);
      }

      // Format code using Prettier
      async function formatCode() {
        const code = editor.getValue();
        if (!code.trim()) {
          showToast("Nothing to format!", "error");
          return;
        }

        const lang = languageSelect.value;

        try {
          let formatted;
          const plugins = [
            prettierPlugins.babel,
            prettierPlugins.estree,
            prettierPlugins.html,
            prettierPlugins.postcss,
            prettierPlugins.typescript,
          ];

          if (lang === "javascript") {
            formatted = await prettier.format(code, {
              parser: "babel",
              plugins,
              semi: true,
              singleQuote: true,
            });
          } else if (lang === "typescript") {
            formatted = await prettier.format(code, {
              parser: "typescript",
              plugins,
              semi: true,
              singleQuote: true,
            });
          } else if (lang === "html") {
            formatted = await prettier.format(code, {
              parser: "html",
              plugins,
            });
          } else if (lang === "css") {
            formatted = await prettier.format(code, { parser: "css", plugins });
          } else {
            // For languages Prettier doesn't support, do basic indentation
            formatted = basicFormat(code);
          }

          editor.setValue(formatted.trim());
          showToast("Code formatted! ‚ú®", "success");
        } catch (error) {
          console.error("Format error:", error);
          showToast("Could not format - check syntax", "error");
        }
      }

      // Basic formatting for unsupported languages
      function basicFormat(code) {
        let formatted = "";
        let indent = 0;
        const lines = code.split("\n");

        for (let line of lines) {
          const trimmed = line.trim();
          if (
            trimmed.endsWith("}") ||
            trimmed.endsWith(")") ||
            trimmed.startsWith("}")
          ) {
            indent = Math.max(0, indent - 1);
          }
          formatted += "  ".repeat(indent) + trimmed + "\n";
          if (
            trimmed.endsWith("{") ||
            trimmed.endsWith("(") ||
            trimmed.endsWith(":")
          ) {
            indent++;
          }
        }
        return formatted;
      }

      // Copy code
      function copyCode() {
        const code = editor.getValue();
        if (!code.trim()) {
          showToast("Nothing to copy!", "error");
          return;
        }
        navigator.clipboard.writeText(code);
        showToast("Code copied! üìã", "success");
      }

      // Clear editor
      function clearEditor() {
        editor.setValue("");
        snippetName.value = "";
        fileInfo.textContent = "Untitled.js";
        showToast("Editor cleared!", "info");
      }

      // Save snippet
      function saveSnippet() {
        const code = editor.getValue().trim();
        if (!code) {
          showToast("Please enter some code first!", "error");
          return;
        }

        const name =
          snippetName.value.trim() || `Snippet ${snippets.length + 1}`;
        const language = languageSelect.value;

        const snippet = {
          id: Date.now(),
          name,
          language,
          code,
          createdAt: new Date().toLocaleDateString(),
          lines: code.split("\n").length,
        };

        snippets.unshift(snippet);
        localStorage.setItem("codeSnippets", JSON.stringify(snippets));
        renderSnippets();
        updateStats();
        showToast(`"${name}" saved! üíæ`, "success");

        editor.setValue("");
        snippetName.value = "";
        updateFileInfo();
      }

      // Download snippet
      function downloadSnippet() {
        const code = editor.getValue().trim();
        if (!code) {
          showToast("Nothing to download!", "error");
          return;
        }

        const name = snippetName.value.trim() || "snippet";
        const ext = extensions[languageSelect.value];
        const blob = new Blob([code], { type: "text/plain" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = `${name}${ext}`;
        a.click();

        URL.revokeObjectURL(url);
        showToast("File downloaded! ‚¨áÔ∏è", "success");
      }

      // Load snippet
      function loadSnippet(id) {
        const snippet = snippets.find((s) => s.id === id);
        if (snippet) {
          editor.setValue(snippet.code);
          snippetName.value = snippet.name;
          languageSelect.value = snippet.language;
          editor.setOption("mode", languageModes[snippet.language]);
          updateFileInfo();
          showToast(`"${snippet.name}" loaded! üì§`, "info");
          document
            .querySelector(".editor-section")
            .scrollIntoView({ behavior: "smooth" });
        }
      }

      // Delete snippet
      function deleteSnippet(id) {
        const snippet = snippets.find((s) => s.id === id);
        snippets = snippets.filter((s) => s.id !== id);
        localStorage.setItem("codeSnippets", JSON.stringify(snippets));
        renderSnippets();
        updateStats();
        showToast(`"${snippet.name}" deleted!`, "error");
      }

      // Escape HTML
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Render snippets
      function renderSnippets(searchTerm = "") {
        let filtered = snippets;

        if (searchTerm) {
          filtered = snippets.filter(
            (s) =>
              s.name.toLowerCase().includes(searchTerm) ||
              s.language.toLowerCase().includes(searchTerm) ||
              s.code.toLowerCase().includes(searchTerm)
          );
        }

        if (filtered.length === 0) {
          snippetsGrid.innerHTML = `
            <div class="empty-state">
              <div class="icon">${searchTerm ? "üîç" : "üì≠"}</div>
              <h3>${
                searchTerm ? "No matching snippets" : "No snippets saved yet"
              }</h3>
              <p>${
                searchTerm
                  ? "Try a different search term"
                  : "Start by pasting some code and clicking Save!"
              }</p>
            </div>
          `;
          snippetCount.textContent = "0 snippets";
          return;
        }

        snippetCount.textContent = `${filtered.length} snippet${
          filtered.length > 1 ? "s" : ""
        }`;

        snippetsGrid.innerHTML = filtered
          .map((snippet) => {
            const prismLang = prismLanguages[snippet.language] || "javascript";
            let highlightedCode;

            try {
              highlightedCode = Prism.highlight(
                snippet.code.substring(0, 500),
                Prism.languages[prismLang] || Prism.languages.javascript,
                prismLang
              );
            } catch (e) {
              highlightedCode = escapeHtml(snippet.code.substring(0, 500));
            }

            return `
            <div class="snippet-card">
              <div class="snippet-card-header">
                <div class="snippet-info">
                  <div class="snippet-name">${escapeHtml(snippet.name)}</div>
                  <div class="snippet-meta">
                    <span class="lang-badge lang-${snippet.language}">${
              snippet.language
            }</span>
                    <span>üìÖ ${snippet.createdAt}</span>
                    <span>üìè ${snippet.lines} lines</span>
                  </div>
                </div>
                <div class="snippet-actions">
                  <button class="action-btn load" onclick="loadSnippet(${
                    snippet.id
                  })" title="Load">üì§</button>
                  <button class="action-btn delete" onclick="deleteSnippet(${
                    snippet.id
                  })" title="Delete">üóëÔ∏è</button>
                </div>
              </div>
              <div class="snippet-preview">
                <pre><code class="language-${prismLang}">${highlightedCode}</code></pre>
              </div>
            </div>
          `;
          })
          .join("");
      }

      // Update stats
      function updateStats() {
        document.getElementById("totalSnippets").textContent = snippets.length;
        const totalLines = snippets.reduce((sum, s) => sum + s.lines, 0);
        document.getElementById("totalLines").textContent = totalLines;
        const uniqueLangs = [...new Set(snippets.map((s) => s.language))]
          .length;
        document.getElementById("totalLangs").textContent = uniqueLangs;
      }

      // Initialize
      renderSnippets();
      updateStats();
      updateFileInfo();
    </script>
  </body>
</html>
