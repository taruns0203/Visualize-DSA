<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Animated Recursive Merge Visualization</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Poppins:wght@400;600;700&family=Permanent+Marker&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Poppins", sans-serif;
        background: linear-gradient(
          135deg,
          #0f0c29 0%,
          #302b63 50%,
          #24243e 100%
        );
        min-height: 100vh;
        padding: 20px;
        overflow-x: hidden;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      /* Header */
      .header {
        text-align: center;
        margin-bottom: 30px;
      }

      .title {
        font-family: "Permanent Marker", cursive;
        font-size: 2.5rem;
        background: linear-gradient(90deg, #00d9ff, #00ff88, #ff00ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 10px;
        animation: titleGlow 3s ease-in-out infinite;
      }

      @keyframes titleGlow {
        0%,
        100% {
          filter: drop-shadow(0 0 10px rgba(0, 217, 255, 0.5));
        }
        50% {
          filter: drop-shadow(0 0 20px rgba(0, 255, 136, 0.8));
        }
      }

      .subtitle {
        color: #a0aec0;
        font-size: 1.1rem;
      }

      /* Problem Display */
      .problem-display {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      .list-display {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .list-label {
        font-family: "Fira Code", monospace;
        font-size: 1.1rem;
        font-weight: 600;
      }

      .list-label.l1 {
        color: #00d9ff;
      }
      .list-label.l2 {
        color: #ff6b9d;
      }

      .node-chain {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .display-node {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Fira Code", monospace;
        font-size: 1.2rem;
        font-weight: 600;
        color: white;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      }

      .display-node.l1 {
        background: linear-gradient(135deg, #00d9ff, #0099cc);
      }
      .display-node.l2 {
        background: linear-gradient(135deg, #ff6b9d, #cc3366);
      }

      .display-arrow {
        color: #666;
        font-size: 1.2rem;
      }

      /* Main Visualization Area */
      .viz-area {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
        margin-bottom: 30px;
      }

      @media (max-width: 1100px) {
        .viz-area {
          grid-template-columns: 1fr;
        }
      }

      /* Call Stack Panel */
      .stack-panel {
        background: rgba(0, 0, 0, 0.4);
        border-radius: 20px;
        padding: 25px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
      }

      .panel-title {
        font-family: "Permanent Marker", cursive;
        font-size: 1.4rem;
        color: #00d9ff;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .stack-container {
        display: flex;
        flex-direction: column;
        gap: 12px;
        min-height: 500px;
      }

      .stack-frame {
        background: linear-gradient(135deg, #1a1a3e, #2d2d5a);
        border-radius: 12px;
        padding: 15px 20px;
        border-left: 5px solid #00d9ff;
        transform: translateX(-100%);
        opacity: 0;
        transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }

      .stack-frame.visible {
        transform: translateX(0);
        opacity: 1;
      }

      .stack-frame.active {
        border-left-color: #00ff88;
        box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
        background: linear-gradient(135deg, #1a2a3e, #2d4a5a);
      }

      .stack-frame.returning {
        border-left-color: #ff6b9d;
        background: linear-gradient(135deg, #2a1a2e, #4a2d4a);
      }

      .stack-frame.base-case {
        border-left-color: #ffcc00;
        background: linear-gradient(135deg, #2a2a1e, #4a4a2d);
        animation: baseCasePulse 1s ease-in-out infinite;
      }

      @keyframes baseCasePulse {
        0%,
        100% {
          box-shadow: 0 0 20px rgba(255, 204, 0, 0.3);
        }
        50% {
          box-shadow: 0 0 40px rgba(255, 204, 0, 0.6);
        }
      }

      .frame-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .frame-badge {
        font-family: "Fira Code", monospace;
        font-size: 0.85rem;
        padding: 4px 12px;
        border-radius: 20px;
        background: rgba(0, 217, 255, 0.2);
        color: #00d9ff;
      }

      .frame-status {
        font-size: 0.85rem;
        padding: 4px 12px;
        border-radius: 20px;
      }

      .frame-status.calling {
        background: rgba(0, 255, 136, 0.2);
        color: #00ff88;
      }

      .frame-status.returning {
        background: rgba(255, 107, 157, 0.2);
        color: #ff6b9d;
      }

      .frame-status.base {
        background: rgba(255, 204, 0, 0.2);
        color: #ffcc00;
      }

      .frame-call {
        font-family: "Fira Code", monospace;
        font-size: 0.95rem;
        color: #e0e0e0;
        margin-bottom: 8px;
      }

      .frame-call .l1 {
        color: #00d9ff;
      }
      .frame-call .l2 {
        color: #ff6b9d;
      }
      .frame-call .null {
        color: #666;
        font-style: italic;
      }

      .frame-comparison {
        font-size: 0.9rem;
        color: #a0aec0;
        margin-bottom: 8px;
      }

      .frame-comparison .yes {
        color: #00ff88;
        font-weight: 600;
      }
      .frame-comparison .no {
        color: #ff6b9d;
        font-weight: 600;
      }

      .frame-action {
        font-family: "Fira Code", monospace;
        font-size: 0.85rem;
        color: #888;
        padding: 8px 12px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
      }

      .frame-return {
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px dashed rgba(255, 107, 157, 0.3);
        font-family: "Fira Code", monospace;
        font-size: 0.9rem;
        color: #ff6b9d;
      }

      /* Tree Panel */
      .tree-panel {
        background: rgba(0, 0, 0, 0.4);
        border-radius: 20px;
        padding: 25px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
      }

      .tree-container {
        position: relative;
        height: 500px;
        overflow: hidden;
      }

      .tree-node {
        position: absolute;
        background: linear-gradient(135deg, #1a1a3e, #2d2d5a);
        border-radius: 10px;
        padding: 10px 15px;
        border: 2px solid #00d9ff;
        font-family: "Fira Code", monospace;
        font-size: 0.8rem;
        color: #e0e0e0;
        opacity: 0;
        transform: scale(0);
        transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        white-space: nowrap;
      }

      .tree-node.visible {
        opacity: 1;
        transform: scale(1);
      }

      .tree-node.active {
        border-color: #00ff88;
        box-shadow: 0 0 25px rgba(0, 255, 136, 0.5);
      }

      .tree-node.returning {
        border-color: #ff6b9d;
        background: linear-gradient(135deg, #2a1a2e, #4a2d4a);
      }

      .tree-node.base-case {
        border-color: #ffcc00;
        background: linear-gradient(135deg, #2a2a1e, #4a4a2d);
      }

      .tree-node .l1 {
        color: #00d9ff;
      }
      .tree-node .l2 {
        color: #ff6b9d;
      }

      .tree-edge {
        position: absolute;
        background: #00d9ff;
        height: 3px;
        transform-origin: left center;
        opacity: 0;
        transition: all 0.4s ease;
      }

      .tree-edge.visible {
        opacity: 0.6;
      }

      .tree-edge.returning {
        background: #ff6b9d;
      }

      .return-badge {
        position: absolute;
        font-family: "Fira Code", monospace;
        font-size: 0.75rem;
        padding: 4px 10px;
        background: linear-gradient(135deg, #2d6a4f, #40916c);
        color: white;
        border-radius: 15px;
        opacity: 0;
        transform: translateY(10px);
        transition: all 0.4s ease;
        white-space: nowrap;
      }

      .return-badge.visible {
        opacity: 1;
        transform: translateY(0);
      }

      /* Current Step Display */
      .step-display {
        background: rgba(0, 0, 0, 0.5);
        border-radius: 15px;
        padding: 20px 30px;
        margin-bottom: 25px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        text-align: center;
      }

      .step-phase {
        font-size: 0.9rem;
        color: #a0aec0;
        margin-bottom: 8px;
      }

      .step-description {
        font-family: "Fira Code", monospace;
        font-size: 1.1rem;
        color: #fff;
        margin-bottom: 10px;
      }

      .step-description .highlight {
        color: #00ff88;
        font-weight: 600;
      }

      .step-description .l1 {
        color: #00d9ff;
      }
      .step-description .l2 {
        color: #ff6b9d;
      }

      /* Progress Bar */
      .progress-container {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        height: 8px;
        margin-top: 15px;
        overflow: hidden;
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #00d9ff, #00ff88);
        border-radius: 10px;
        transition: width 0.3s ease;
      }

      /* Controls */
      .controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 25px;
        flex-wrap: wrap;
      }

      .control-btn {
        font-family: "Poppins", sans-serif;
        font-size: 1rem;
        font-weight: 600;
        padding: 12px 25px;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .control-btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }

      .control-btn.prev {
        background: linear-gradient(135deg, #4a4a6a, #3a3a5a);
        color: white;
      }

      .control-btn.next {
        background: linear-gradient(135deg, #00d9ff, #0099cc);
        color: white;
      }

      .control-btn.play {
        background: linear-gradient(135deg, #00ff88, #00cc6a);
        color: #1a1a2e;
      }

      .control-btn.reset {
        background: linear-gradient(135deg, #ff6b9d, #cc3366);
        color: white;
      }

      .control-btn:not(:disabled):hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .speed-control {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #a0aec0;
      }

      .speed-slider {
        width: 100px;
        height: 6px;
        border-radius: 3px;
        background: rgba(255, 255, 255, 0.2);
        outline: none;
        -webkit-appearance: none;
      }

      .speed-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #00d9ff;
        cursor: pointer;
      }

      /* Final Result */
      .final-result {
        background: linear-gradient(
          135deg,
          rgba(0, 255, 136, 0.1),
          rgba(0, 217, 255, 0.1)
        );
        border: 2px solid #00ff88;
        border-radius: 20px;
        padding: 30px;
        text-align: center;
        opacity: 0;
        transform: scale(0.9);
        transition: all 0.5s ease;
      }

      .final-result.visible {
        opacity: 1;
        transform: scale(1);
      }

      .final-title {
        font-family: "Permanent Marker", cursive;
        font-size: 1.8rem;
        color: #00ff88;
        margin-bottom: 20px;
      }

      .final-nodes {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 25px;
      }

      .final-node {
        width: 55px;
        height: 55px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Fira Code", monospace;
        font-size: 1.4rem;
        font-weight: 600;
        color: white;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        opacity: 0;
        transform: scale(0) rotate(-180deg);
        transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }

      .final-node.visible {
        opacity: 1;
        transform: scale(1) rotate(0deg);
      }

      .final-node.l1 {
        background: linear-gradient(135deg, #00d9ff, #0099cc);
      }
      .final-node.l2 {
        background: linear-gradient(135deg, #ff6b9d, #cc3366);
      }

      .final-arrow {
        font-size: 1.5rem;
        color: #00ff88;
        opacity: 0;
        transition: all 0.3s ease;
      }

      .final-arrow.visible {
        opacity: 1;
      }

      /* Complexity Cards */
      .complexity-cards {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
      }

      .complexity-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 15px 25px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .complexity-label {
        font-size: 0.85rem;
        color: #a0aec0;
        margin-bottom: 5px;
      }

      .complexity-value {
        font-family: "Fira Code", monospace;
        font-size: 1.3rem;
        font-weight: 600;
      }

      .complexity-card.time .complexity-value {
        color: #00d9ff;
      }
      .complexity-card.space .complexity-value {
        color: #ff6b9d;
      }

      /* Code Section */
      .code-section {
        background: #1e1e1e;
        border-radius: 15px;
        padding: 20px;
        margin-top: 25px;
        overflow-x: auto;
      }

      .code-title {
        font-family: "Fira Code", monospace;
        font-size: 0.9rem;
        color: #00d9ff;
        margin-bottom: 15px;
      }

      .code-block {
        font-family: "Fira Code", monospace;
        font-size: 0.85rem;
        line-height: 1.8;
        color: #d4d4d4;
      }

      .code-block .keyword {
        color: #c586c0;
      }
      .code-block .function {
        color: #dcdcaa;
      }
      .code-block .param {
        color: #9cdcfe;
      }
      .code-block .comment {
        color: #6a9955;
      }
      .code-block .null {
        color: #569cd6;
      }

      .code-line {
        padding: 2px 10px;
        margin: 0 -10px;
        border-radius: 4px;
        transition: background 0.3s ease;
      }

      .code-line.highlight {
        background: rgba(0, 255, 136, 0.15);
      }

      /* Responsive */
      @media (max-width: 768px) {
        .title {
          font-size: 1.8rem;
        }
        .viz-area {
          gap: 15px;
        }
        .stack-panel,
        .tree-panel {
          padding: 15px;
        }
        .tree-container {
          height: 400px;
        }
        .stack-container {
          min-height: 400px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1 class="title">üîÑ Recursive Merge Animation</h1>
        <p class="subtitle">
          Watch the call stack grow and unwind step by step
        </p>
      </div>

      <!-- Problem Display -->
      <div class="problem-display">
        <div class="list-display">
          <span class="list-label l1">list1 =</span>
          <div class="node-chain">
            <div class="display-node l1">1</div>
            <span class="display-arrow">‚Üí</span>
            <div class="display-node l1">2</div>
            <span class="display-arrow">‚Üí</span>
            <div class="display-node l1">4</div>
          </div>
        </div>
        <div class="list-display">
          <span class="list-label l2">list2 =</span>
          <div class="node-chain">
            <div class="display-node l2">1</div>
            <span class="display-arrow">‚Üí</span>
            <div class="display-node l2">3</div>
            <span class="display-arrow">‚Üí</span>
            <div class="display-node l2">4</div>
          </div>
        </div>
      </div>

      <!-- Step Display -->
      <div class="step-display">
        <div class="step-phase" id="stepPhase">Ready to start</div>
        <div class="step-description" id="stepDescription">
          Click <span class="highlight">Next</span> or
          <span class="highlight">Play</span> to begin the animation
        </div>
        <div class="progress-container">
          <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button class="control-btn prev" id="prevBtn" onclick="prevStep()">
          <span>‚Üê</span> Previous
        </button>
        <button class="control-btn next" id="nextBtn" onclick="nextStep()">
          Next <span>‚Üí</span>
        </button>
        <button class="control-btn play" id="playBtn" onclick="togglePlay()">
          <span id="playIcon">‚ñ∂</span> <span id="playText">Play</span>
        </button>
        <button class="control-btn reset" onclick="resetAnimation()">
          <span>‚Ü∫</span> Reset
        </button>
        <div class="speed-control">
          <span>Speed:</span>
          <input
            type="range"
            class="speed-slider"
            id="speedSlider"
            min="500"
            max="2500"
            value="1200"
            onchange="updateSpeed()"
          />
        </div>
      </div>

      <!-- Main Visualization -->
      <div class="viz-area">
        <!-- Call Stack Panel -->
        <div class="stack-panel">
          <div class="panel-title">
            <span>üìö</span>
            <span>Call Stack</span>
          </div>
          <div class="stack-container" id="stackContainer">
            <!-- Stack frames will be added dynamically -->
          </div>
        </div>

        <!-- Tree Panel -->
        <div class="tree-panel">
          <div class="panel-title">
            <span>üå≥</span>
            <span>Recursion Tree</span>
          </div>
          <div class="tree-container" id="treeContainer">
            <!-- Tree nodes and edges will be added dynamically -->
          </div>
        </div>
      </div>

      <!-- Final Result -->
      <div class="final-result" id="finalResult">
        <div class="final-title">‚úÖ Recursion Complete!</div>
        <div class="final-nodes" id="finalNodes">
          <div class="final-node l1" data-index="0">1</div>
          <span class="final-arrow" data-index="0">‚Üí</span>
          <div class="final-node l2" data-index="1">1</div>
          <span class="final-arrow" data-index="1">‚Üí</span>
          <div class="final-node l1" data-index="2">2</div>
          <span class="final-arrow" data-index="2">‚Üí</span>
          <div class="final-node l2" data-index="3">3</div>
          <span class="final-arrow" data-index="3">‚Üí</span>
          <div class="final-node l1" data-index="4">4</div>
          <span class="final-arrow" data-index="4">‚Üí</span>
          <div class="final-node l2" data-index="5">4</div>
        </div>
        <div class="complexity-cards">
          <div class="complexity-card time">
            <div class="complexity-label">Time Complexity</div>
            <div class="complexity-value">O(n + m)</div>
          </div>
          <div class="complexity-card space">
            <div class="complexity-label">Space Complexity</div>
            <div class="complexity-value">O(n + m)</div>
          </div>
        </div>

        <!-- Code Section -->
        <div class="code-section">
          <div class="code-title">// Recursive Implementation</div>
          <pre
            class="code-block"
          ><span class="code-line" id="codeLine1"><span class="keyword">function</span> <span class="function">mergeTwoLists</span>(<span class="param">list1</span>, <span class="param">list2</span>) {</span>
<span class="code-line" id="codeLine2">    <span class="keyword">if</span> (<span class="param">list1</span> === <span class="null">null</span>) <span class="keyword">return</span> <span class="param">list2</span>;</span>
<span class="code-line" id="codeLine3">    <span class="keyword">if</span> (<span class="param">list2</span> === <span class="null">null</span>) <span class="keyword">return</span> <span class="param">list1</span>;</span>
<span class="code-line" id="codeLine4"></span>
<span class="code-line" id="codeLine5">    <span class="keyword">if</span> (<span class="param">list1</span>.val <= <span class="param">list2</span>.val) {</span>
<span class="code-line" id="codeLine6">        <span class="param">list1</span>.next = <span class="function">mergeTwoLists</span>(<span class="param">list1</span>.next, <span class="param">list2</span>);</span>
<span class="code-line" id="codeLine7">        <span class="keyword">return</span> <span class="param">list1</span>;</span>
<span class="code-line" id="codeLine8">    } <span class="keyword">else</span> {</span>
<span class="code-line" id="codeLine9">        <span class="param">list2</span>.next = <span class="function">mergeTwoLists</span>(<span class="param">list1</span>, <span class="param">list2</span>.next);</span>
<span class="code-line" id="codeLine10">        <span class="keyword">return</span> <span class="param">list2</span>;</span>
<span class="code-line" id="codeLine11">    }</span>
<span class="code-line" id="codeLine12">}</span></pre>
        </div>
      </div>
    </div>

    <script>
      // Animation state
      let currentStep = -1;
      let isPlaying = false;
      let playInterval = null;
      let animationSpeed = 1200;

      // Steps data
      const steps = [
        {
          phase: "GOING DOWN",
          call: 1,
          l1: [1, 2, 4],
          l2: [1, 3, 4],
          compare: { v1: 1, v2: 1, result: "yes" },
          action: "list1.next = merge([2,4], [1,3,4])",
          description:
            'Comparing <span class="l1">1</span> ‚â§ <span class="l2">1</span>? <span class="highlight">Yes!</span> Pick list1\'s node, recurse...',
          codeLines: [5, 6],
        },
        {
          phase: "GOING DOWN",
          call: 2,
          l1: [2, 4],
          l2: [1, 3, 4],
          compare: { v1: 2, v2: 1, result: "no" },
          action: "list2.next = merge([2,4], [3,4])",
          description:
            'Comparing <span class="l1">2</span> ‚â§ <span class="l2">1</span>? <span class="highlight">No!</span> Pick list2\'s node, recurse...',
          codeLines: [8, 9],
        },
        {
          phase: "GOING DOWN",
          call: 3,
          l1: [2, 4],
          l2: [3, 4],
          compare: { v1: 2, v2: 3, result: "yes" },
          action: "list1.next = merge([4], [3,4])",
          description:
            'Comparing <span class="l1">2</span> ‚â§ <span class="l2">3</span>? <span class="highlight">Yes!</span> Pick list1\'s node, recurse...',
          codeLines: [5, 6],
        },
        {
          phase: "GOING DOWN",
          call: 4,
          l1: [4],
          l2: [3, 4],
          compare: { v1: 4, v2: 3, result: "no" },
          action: "list2.next = merge([4], [4])",
          description:
            'Comparing <span class="l1">4</span> ‚â§ <span class="l2">3</span>? <span class="highlight">No!</span> Pick list2\'s node, recurse...',
          codeLines: [8, 9],
        },
        {
          phase: "GOING DOWN",
          call: 5,
          l1: [4],
          l2: [4],
          compare: { v1: 4, v2: 4, result: "yes" },
          action: "list1.next = merge([], [4])",
          description:
            'Comparing <span class="l1">4</span> ‚â§ <span class="l2">4</span>? <span class="highlight">Yes!</span> Pick list1\'s node, recurse...',
          codeLines: [5, 6],
        },
        {
          phase: "üéØ BASE CASE",
          call: 6,
          l1: [],
          l2: [4],
          compare: null,
          action: "return list2",
          description:
            'list1 is <span class="highlight">null</span>! Return list2 = <span class="l2">[4]</span>',
          returnValue: "[4]",
          codeLines: [2],
        },
        {
          phase: "COMING UP",
          call: 5,
          returnValue: "[4‚Üí4]",
          description:
            'Set list1.next = [4], return <span class="highlight">[4‚Üí4]</span>',
          codeLines: [6, 7],
        },
        {
          phase: "COMING UP",
          call: 4,
          returnValue: "[3‚Üí4‚Üí4]",
          description:
            'Set list2.next = [4‚Üí4], return <span class="highlight">[3‚Üí4‚Üí4]</span>',
          codeLines: [9, 10],
        },
        {
          phase: "COMING UP",
          call: 3,
          returnValue: "[2‚Üí3‚Üí4‚Üí4]",
          description:
            'Set list1.next = [3‚Üí4‚Üí4], return <span class="highlight">[2‚Üí3‚Üí4‚Üí4]</span>',
          codeLines: [6, 7],
        },
        {
          phase: "COMING UP",
          call: 2,
          returnValue: "[1‚Üí2‚Üí3‚Üí4‚Üí4]",
          description:
            'Set list2.next = [2‚Üí3‚Üí4‚Üí4], return <span class="highlight">[1‚Üí2‚Üí3‚Üí4‚Üí4]</span>',
          codeLines: [9, 10],
        },
        {
          phase: "COMING UP",
          call: 1,
          returnValue: "[1‚Üí1‚Üí2‚Üí3‚Üí4‚Üí4]",
          description:
            'Set list1.next = [1‚Üí2‚Üí3‚Üí4‚Üí4], return <span class="highlight">[1‚Üí1‚Üí2‚Üí3‚Üí4‚Üí4]</span>',
          codeLines: [6, 7],
        },
        {
          phase: "‚úÖ COMPLETE",
          description:
            'Final merged list: <span class="highlight">[1‚Üí1‚Üí2‚Üí3‚Üí4‚Üí4]</span>',
          codeLines: [],
        },
      ];

      // Tree node positions
      const treePositions = [
        { x: 280, y: 20 }, // Call 1
        { x: 180, y: 100 }, // Call 2
        { x: 100, y: 180 }, // Call 3
        { x: 180, y: 260 }, // Call 4
        { x: 280, y: 340 }, // Call 5
        { x: 400, y: 420 }, // Call 6 (base case)
      ];

      // Initialize
      function init() {
        renderStackFrames();
        renderTree();
        updateButtons();
        updateStepDisplay();
      }

      // Render stack frames
      function renderStackFrames() {
        const container = document.getElementById("stackContainer");
        container.innerHTML = "";

        for (let i = 0; i <= 5; i++) {
          const step = steps[i];
          const frame = document.createElement("div");
          frame.className = "stack-frame";
          frame.id = `frame-${i}`;

          const l1Str =
            step.l1.length > 0
              ? `[${step.l1.join(",")}]`
              : '<span class="null">null</span>';
          const l2Str =
            step.l2.length > 0
              ? `[${step.l2.join(",")}]`
              : '<span class="null">null</span>';

          let comparisonHtml = "";
          if (step.compare) {
            const resultClass = step.compare.result === "yes" ? "yes" : "no";
            comparisonHtml = `
                        <div class="frame-comparison">
                            <span class="l1">${step.compare.v1}</span> ‚â§ 
                            <span class="l2">${step.compare.v2}</span> ? 
                            <span class="${resultClass}">${step.compare.result.toUpperCase()}</span>
                        </div>
                    `;
          }

          frame.innerHTML = `
                    <div class="frame-header">
                        <span class="frame-badge">Call #${step.call}</span>
                        <span class="frame-status calling" id="status-${i}">Calling</span>
                    </div>
                    <div class="frame-call">
                        merge(<span class="l1">${l1Str}</span>, <span class="l2">${l2Str}</span>)
                    </div>
                    ${comparisonHtml}
                    <div class="frame-action">${step.action}</div>
                    <div class="frame-return" id="return-${i}" style="display: none;">
                        ‚Ü© Returns: <span id="return-value-${i}"></span>
                    </div>
                `;

          container.appendChild(frame);
        }
      }

      // Render tree
      function renderTree() {
        const container = document.getElementById("treeContainer");
        container.innerHTML = "";

        // Create edges
        for (let i = 0; i < 5; i++) {
          const from = treePositions[i];
          const to = treePositions[i + 1];

          const edge = document.createElement("div");
          edge.className = "tree-edge";
          edge.id = `edge-${i}`;

          const dx = to.x - from.x;
          const dy = to.y - from.y;
          const length = Math.sqrt(dx * dx + dy * dy);
          const angle = (Math.atan2(dy, dx) * 180) / Math.PI;

          edge.style.left = from.x + 60 + "px";
          edge.style.top = from.y + 20 + "px";
          edge.style.width = length - 40 + "px";
          edge.style.transform = `rotate(${angle}deg)`;

          container.appendChild(edge);
        }

        // Create nodes
        for (let i = 0; i <= 5; i++) {
          const step = steps[i];
          const pos = treePositions[i];

          const node = document.createElement("div");
          node.className = "tree-node";
          node.id = `tree-node-${i}`;

          const l1Str = step.l1.length > 0 ? `[${step.l1.join(",")}]` : "[]";
          const l2Str = step.l2.length > 0 ? `[${step.l2.join(",")}]` : "[]";

          node.innerHTML = `<span class="l1">${l1Str}</span>, <span class="l2">${l2Str}</span>`;
          node.style.left = pos.x + "px";
          node.style.top = pos.y + "px";

          container.appendChild(node);

          // Return badge
          const badge = document.createElement("div");
          badge.className = "return-badge";
          badge.id = `tree-return-${i}`;
          badge.style.left = pos.x + 130 + "px";
          badge.style.top = pos.y + 5 + "px";
          container.appendChild(badge);
        }
      }

      // Update display for current step
      function updateDisplay() {
        const totalSteps = steps.length;

        // Update progress bar
        const progress = ((currentStep + 1) / totalSteps) * 100;
        document.getElementById("progressBar").style.width = progress + "%";

        // Clear all highlights
        for (let i = 0; i <= 5; i++) {
          const frame = document.getElementById(`frame-${i}`);
          const treeNode = document.getElementById(`tree-node-${i}`);
          const edge = document.getElementById(`edge-${i}`);

          if (frame) {
            frame.classList.remove(
              "visible",
              "active",
              "returning",
              "base-case"
            );
          }
          if (treeNode) {
            treeNode.classList.remove(
              "visible",
              "active",
              "returning",
              "base-case"
            );
          }
          if (edge) {
            edge.classList.remove("visible", "returning");
          }
        }

        // Reset code highlights
        for (let i = 1; i <= 12; i++) {
          document.getElementById(`codeLine${i}`).classList.remove("highlight");
        }

        // Reset return displays
        for (let i = 0; i <= 5; i++) {
          document.getElementById(`return-${i}`).style.display = "none";
          document
            .getElementById(`tree-return-${i}`)
            .classList.remove("visible");
        }

        // Apply current state based on step
        if (currentStep >= 0) {
          const step = steps[currentStep];

          // Going down phase (steps 0-5)
          if (currentStep <= 5) {
            for (let i = 0; i <= currentStep; i++) {
              const frame = document.getElementById(`frame-${i}`);
              const treeNode = document.getElementById(`tree-node-${i}`);
              const edge = document.getElementById(`edge-${i - 1}`);

              frame.classList.add("visible");
              treeNode.classList.add("visible");

              if (edge) edge.classList.add("visible");

              if (i === currentStep) {
                frame.classList.add("active");
                treeNode.classList.add("active");

                if (currentStep === 5) {
                  frame.classList.add("base-case");
                  treeNode.classList.add("base-case");
                  document.getElementById(`status-${i}`).textContent =
                    "Base Case";
                  document.getElementById(`status-${i}`).className =
                    "frame-status base";
                }
              }
            }
          }
          // Coming up phase (steps 6-10)
          else if (currentStep <= 10) {
            const returningCall = 11 - currentStep; // 5, 4, 3, 2, 1

            // Show all frames that are still on stack
            for (let i = 0; i <= returningCall; i++) {
              const frame = document.getElementById(`frame-${i}`);
              const treeNode = document.getElementById(`tree-node-${i}`);
              const edge = document.getElementById(`edge-${i - 1}`);

              frame.classList.add("visible");
              treeNode.classList.add("visible");
              if (edge) edge.classList.add("visible");

              if (i === returningCall) {
                frame.classList.add("returning");
                treeNode.classList.add("returning");
                document.getElementById(`status-${i}`).textContent =
                  "Returning";
                document.getElementById(`status-${i}`).className =
                  "frame-status returning";

                // Show return value
                document.getElementById(`return-${i}`).style.display = "block";
                document.getElementById(`return-value-${i}`).textContent =
                  step.returnValue;

                // Show tree return badge
                const badge = document.getElementById(`tree-return-${i}`);
                badge.textContent = "‚Üí " + step.returnValue;
                badge.classList.add("visible");
              }
            }

            // Mark returned edges
            for (let i = returningCall; i < 5; i++) {
              const edge = document.getElementById(`edge-${i}`);
              if (edge) {
                edge.classList.add("visible", "returning");
              }

              // Show return badges for completed returns
              const returnIdx = 10 - (5 - i);
              if (returnIdx <= currentStep && returnIdx >= 6) {
                const badge = document.getElementById(`tree-return-${i + 1}`);
                badge.textContent = "‚Üí " + steps[returnIdx].returnValue;
                badge.classList.add("visible");
              }
            }
          }
          // Complete (step 11)
          else {
            // Show final result
            document.getElementById("finalResult").classList.add("visible");

            // Animate final nodes
            const finalNodes = document.querySelectorAll(".final-node");
            const finalArrows = document.querySelectorAll(".final-arrow");

            finalNodes.forEach((node, idx) => {
              setTimeout(() => {
                node.classList.add("visible");
                if (finalArrows[idx]) {
                  finalArrows[idx].classList.add("visible");
                }
              }, idx * 150);
            });
          }

          // Highlight code lines
          if (step.codeLines) {
            step.codeLines.forEach((line) => {
              document
                .getElementById(`codeLine${line}`)
                .classList.add("highlight");
            });
          }
        }

        // Hide final result if not at last step
        if (currentStep < 11) {
          document.getElementById("finalResult").classList.remove("visible");
          document
            .querySelectorAll(".final-node")
            .forEach((n) => n.classList.remove("visible"));
          document
            .querySelectorAll(".final-arrow")
            .forEach((a) => a.classList.remove("visible"));
        }

        updateStepDisplay();
        updateButtons();
      }

      // Update step display
      function updateStepDisplay() {
        const phaseEl = document.getElementById("stepPhase");
        const descEl = document.getElementById("stepDescription");

        if (currentStep < 0) {
          phaseEl.textContent = "Ready to start";
          descEl.innerHTML =
            'Click <span class="highlight">Next</span> or <span class="highlight">Play</span> to begin the animation';
        } else {
          const step = steps[currentStep];
          phaseEl.textContent = `Step ${currentStep + 1} of ${steps.length}: ${
            step.phase
          }`;
          descEl.innerHTML = step.description;
        }
      }

      // Update buttons
      function updateButtons() {
        document.getElementById("prevBtn").disabled = currentStep < 0;
        document.getElementById("nextBtn").disabled =
          currentStep >= steps.length - 1;
      }

      // Navigation functions
      function nextStep() {
        if (currentStep < steps.length - 1) {
          currentStep++;
          updateDisplay();
        } else {
          stopPlay();
        }
      }

      function prevStep() {
        if (currentStep >= 0) {
          currentStep--;
          updateDisplay();
        }
      }

      function resetAnimation() {
        stopPlay();
        currentStep = -1;
        updateDisplay();
      }

      function togglePlay() {
        if (isPlaying) {
          stopPlay();
        } else {
          startPlay();
        }
      }

      function startPlay() {
        isPlaying = true;
        document.getElementById("playIcon").textContent = "‚è∏";
        document.getElementById("playText").textContent = "Pause";
        document.getElementById("playBtn").classList.remove("play");
        document.getElementById("playBtn").style.background =
          "linear-gradient(135deg, #ff6b9d, #cc3366)";

        playInterval = setInterval(() => {
          if (currentStep < steps.length - 1) {
            nextStep();
          } else {
            stopPlay();
          }
        }, animationSpeed);
      }

      function stopPlay() {
        isPlaying = false;
        document.getElementById("playIcon").textContent = "‚ñ∂";
        document.getElementById("playText").textContent = "Play";
        document.getElementById("playBtn").style.background =
          "linear-gradient(135deg, #00ff88, #00cc6a)";

        if (playInterval) {
          clearInterval(playInterval);
          playInterval = null;
        }
      }

      function updateSpeed() {
        animationSpeed = 3000 - document.getElementById("speedSlider").value;
        if (isPlaying) {
          stopPlay();
          startPlay();
        }
      }

      // Keyboard controls
      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight" || e.key === " ") {
          e.preventDefault();
          nextStep();
        } else if (e.key === "ArrowLeft") {
          e.preventDefault();
          prevStep();
        } else if (e.key === "p" || e.key === "P") {
          togglePlay();
        } else if (e.key === "r" || e.key === "R") {
          resetAnimation();
        }
      });

      // Initialize on load
      init();
    </script>
  </body>
</html>
